2025-11-14 07:25:43,968 Connecting to Teradata
2025-11-14 07:26:24,103 Closing down clientserver connection
2025-11-14 07:26:24,105 Closing down clientserver connection
2025-11-14 07:26:24,696 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'b08c4c90-6dd0-4398-a349-56ec04b16d27', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 26, 24, 643000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'b08c4c90-6dd0-4398-a349-56ec04b16d27', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'id': 0, 'method': 'initialize', 'params': {'capabilities': {'workspace': {'applyEdit': True, 'workspaceEdit': {'failureHandling': 'textOnlyTransactional', 'documentChanges': True, 'resourceOperations': ['create', 'rename', 'delete'], 'changeAnnotationSupport': {'groupsOnLabel': True}, 'normalizesLineEndings': True}}, 'textDocument': {'publishDiagnostics': {'codeDescriptionSupport': True, 'versionSupport': False, 'tagSupport': {'valueSet': [1, 2]}, 'dataSupport': True, 'relatedInformation': True}, 'synchronization': {'dynamicRegistration': True}, 'definition': {'dynamicRegistration': True, 'linkSupport': True}, 'references': {'dynamicRegistration': True}}, 'window': {'showMessage': {'messageActionItem': {'additionalPropertiesSupport': True}}, 'showDocument': {'support': True}}, 'general': {'staleRequestSupport': {'cancel': True, 'retryOnContentModified': ['textDocument/semanticTokens/full', 'textDocument/semanticTokens/range', 'textDocument/semanticTokens/full/delta']}, 'regularExpressions': {'engine': 'ECMAScript', 'version': 'ES2020'}, 'markdown': {'parser': 'marked', 'version': '1.1.0'}, 'positionEncodings': ['utf-16']}}, 'trace': 'off', 'workspaceFolders': None, 'initializationOptions': {'dbls': {'supportedDblsVersions': []}, 'pylsp': {'plugins': {'ruff': {'enabled': True, 'select': ['E9', 'F407', 'F622', 'F701', 'F702', 'F704', 'F706', 'F82']}, 'pyflakes': {'enabled': False}, 'pylsp_ucx': {'enabled': False}, 'mccabe': {'enabled': False}, 'flake8': {'enabled': False}, 'pycodestyle': {'enabled': False}, 'preload': {'enabled': False}}}}, 'clientInfo': {'name': 'Code - OSS', 'version': '1.93.1'}, 'locale': 'en-US', 'rootUri': None, 'rootPath': None, 'processId': None}}}}}, 'buffers': []})
2025-11-14 07:26:25,691 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'b7d9c1c1-34ae-49c2-9315-8ea3e2e2ec9e', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 26, 25, 640000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'b7d9c1c1-34ae-49c2-9315-8ea3e2e2ec9e', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'initialized', 'params': {}}}}}, 'buffers': []})
2025-11-14 07:26:25,710 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'e2b0b12a-2e41-4656-81d1-d171112649ad', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 26, 25, 649000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'e2b0b12a-2e41-4656-81d1-d171112649ad', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didOpen', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'languageId': 'python', 'version': 22, 'text': 'from databricks.sdk.runtime import display, displayHTML, getArgument, sc, spark, sql, sqlContext, table, udf;from dbruntime.dbutils import DBUtils as dbutils;from IPython import get_ipython;In={};Out={};_ih=[];_oh={};_dh=[];_=None;__=None;___=None;_i=None;_ii=None;_sqldf=spark.createDataFrame([], schema=[])\n# %pip install "sqlalchemy<2.0"\ndbutils.library.restartPython()\n\nmode = \'PROD\'\n\n\n\nimport pandas as pd\nimport datetime\nimport logging\nimport os\nimport pyodbc\nimport smtplib as smtp\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.text import MIMEText\n\nfrom email.utils import formataddr\nfrom email.header import Header\nfrom email import encoders\nfrom email.mime.base import MIMEBase\nfrom email.mime.application import MIMEApplication\nfrom email.mime.image import MIMEImage\nimport urllib.parse\nfrom sqlalchemy import create_engine, text\nimport re\nfrom random import *\nimport psycopg2\nos.chdir(r\'/Workspace/Ops Analysis/Reports/745 express weekly\')\nTODAY = datetime.datetime.today().strftime(\'%Y%m%d\')\nYES = datetime.date.today() - datetime.timedelta(days=1)\nLW = datetime.date.today() - datetime.timedelta(days=7)\nYESTERDAY = YES.strftime(\'%m/%d/%Y\')\nLWDATE = LW.strftime(\'%m/%d/%Y\')\nYEST = YES.strftime(\'%Y-%m-%d\')\n\nif mode == \'PROD\':\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr.csv\'\nelse:\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr_test.csv\'\n    \nLOG_FILE_NAME = os.getcwd() + r\'/logs/\' + datetime.datetime.today().strftime(\'%Y%m%d %H%M%S\') + \'.log\'\nCSV_FLDR = os.getcwd() + r\'/CSV/\'\nSQL_FOLDER = os.getcwd() + r\'/SQL\'\nXLSX_FLDR = os.getcwd() + r\'/XLSX/\'\nHTML_FLDR = os.getcwd() + r\'/HTML/\'\nPNG_FLDR = os.getcwd() + r\'/DailyImages/\'\nfilename_attach = os.getcwd() + r\'/0745_UAX_WB_Flights.xlsm\'\nPDF_FLDR = os.getcwd() + r\'/PDF/\'\nfilename = os.getcwd() + r\'/0745_UAX_WB_final_v1.xlsm\'\n\nCID1 =  \'1\'\nCID2 =  \'2\'\n\n\nHTML_BDY_FILE_PATH = HTML_FLDR + r\'EmailBody.htm\'\nHTML_FTR_FILE_PATH = HTML_FLDR + r\'EmailFooter.htm\'\n\nXLS_FILE_PATH = XLSX_FLDR + YEST + r\' 0745 UAX Flight details.xlsm\'\n\nXLS_FILE_NAME = YEST + r\' 0745 Weekly UAX Flight details.xlsm\'\n\nEDW_SQL_1= SQL_FOLDER + r\'/UA_SQL_1.sql\'\nEDW_SQL_2= SQL_FOLDER +r\'/CNXL_SQL_2.sql\'\nEDW_SQL_3= SQL_FOLDER +r\'/RES_CNXL_SQL_3.sql\'\nEDW_SQL_4= SQL_FOLDER +r\'/SCH_DEP_SQL_4.sql\'\nEDW_SQL_5= SQL_FOLDER +r\'/DIVERTS_SQL_5.sql\'\nEDW_SQL_6= SQL_FOLDER +r\'/RECOVERED_DIVERTS_SQL_6.sql\'\nEDW_SQL_7= SQL_FOLDER +r\'/UA_HUB_SQL_7.sql\'\nEDW_SQL_8= SQL_FOLDER +r\'/FLIGHTS_NOT_DEPARTED_SQL_8.sql\'\n\nEDW_SQL_9= SQL_FOLDER +r\'/Cancelled_flights_SQL_9.sql\' ## Converted\nEDW_SQL_10= SQL_FOLDER +r\'/Yet_to_Depart_flights_SQL_10.sql\'\nEDW_SQL_11= SQL_FOLDER +r\'/Residual_cancels_SQL_11.sql\' ## Converted\nEDW_SQL_12= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_SQL_12.sql\'\n\nEDW_SQL_13= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_COUNT_SQL_13.sql\'\nEDW_SQL_14= SQL_FOLDER +r\'/Diverted_flights_SQL_14.sql\'\nEDW_SQL_15 = SQL_FOLDER + r\'/UA_Line.sql\'\nEDW_SQL_16 = SQL_FOLDER + r\'/UA_Seat_Cancels.sql\'\nEDW_SQL_17 = SQL_FOLDER + r\'/Carrier_delays.sql\'\nEDW_SQL_18= SQL_FOLDER +r\'/Delays_info.sql\'\n\n\n\nMF_SQL_1= SQL_FOLDER +r\'/OA_SQL_1.sql\'\nMF_SQL_2= SQL_FOLDER +r\'/OA_SQL_2.sql\'\nMF_SQL_3= SQL_FOLDER +r\'/OA_Line.sql\'\nMF_SQL_4= SQL_FOLDER +r\'/OA_SeatCnxl.sql\'\nUA_SQL_1_CSV_FILE = CSV_FLDR + r\'UA_SQL_1_\' +TODAY+\'.csv\'\nCNXL_SQL_2_CSV_FILE = CSV_FLDR + r\'CNXL_SQL_2_\' +TODAY+\'.csv\'\nRES_CNXL_SQL_3_CSV_FILE = CSV_FLDR + r\'RES_CNXL_SQL_3_\' +TODAY+\'.csv\'\nSCH_DEP_SQL_4_CSV_FILE = CSV_FLDR + r\'SCH_DEP_SQL_4_\' +TODAY+\'.csv\'\nDIVERTS_SQL_5_CSV_FILE = CSV_FLDR + r\'DIVERTS_SQL_5_\' +TODAY+\'.csv\'\nRECOVERED_DIVERTS_SQL_6_CSV_FILE = CSV_FLDR + r\'RECOVERED_DIVERTS_SQL_6_\' +TODAY+\'.csv\'\nUA_HUB_SQL_7_CSV_FILE = CSV_FLDR + r\'UA_HUB_SQL_7_\' +TODAY+\'.csv\'\nFLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE = CSV_FLDR + r\'FLIGHTS_NOT_DEPARTED_SQL_8_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_COUNT_SQL_13_\' +TODAY+\'.csv\'\nCancelled_flights_SQL_9_CSV_FILE = CSV_FLDR + r\'Cancelled_flights_SQL_9_\' +TODAY+\'.csv\'\nYet_to_Depart_flights_SQL_10_CSV_FILE = CSV_FLDR + r\'Yet_to_Depart_flights_SQL_10_\' +TODAY+\'.csv\'\nResidual_cancels_SQL_11_CSV_FILE = CSV_FLDR + r\'Residual_cancels_SQL_11_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_SQL_12_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_SQL_12_\' +TODAY+\'.csv\'\nDIVERTED_FLIGHTS_SQL_14_CSV_FILE = CSV_FLDR + r\'Diverted_flights_SQL_14\' +TODAY+\'.csv\'\nUA_Line_CSV_FILE = CSV_FLDR + r\'UA_Line\' +TODAY+\'.csv\'\nUA_Seat_Cancels_CSV_FILE = CSV_FLDR + r\'UA_Seat_Cancels\' +TODAY+\'.csv\'\nDELAYS_INFO_CSV_FILE = CSV_FLDR + r\'Delays_info\' +TODAY+\'.csv\'\nCarrier_delays_CSV_FILE = CSV_FLDR + r\'Carrier_delays\' +TODAY+\'.csv\'\nOA_SQL_1_CSV_FILE = CSV_FLDR + r\'OA_SQL_1_\' +TODAY+\'.csv\'\nOA_SQL_2_CSV_FILE = CSV_FLDR + r\'OA_SQL_2_\' +TODAY+\'.csv\'\nOA_Line_CSV_FILE = CSV_FLDR + r\'OA_Line_\' +TODAY+\'.csv\'\nOA_SeatCnxl_CSV_FILE = CSV_FLDR + r\'OA_SeatCnxl_\' +TODAY+\'.csv\'\nPNG_FILE_SYS1 = PNG_FLDR + TODAY + r\' pg1.png\'\nXLS_SHT_SYS1 = \'pg1\'\nPNG_FILE_SYS2 = PNG_FLDR + TODAY + r\' pg2.png\'\nXLS_SHT_SYS2 = \'pg2\'\nPDF_FILE_PATH = PDF_FLDR + YEST + r\'_745_UAX\' +\'.pdf\'\n\nlogging.basicConfig(filename=LOG_FILE_NAME, level=logging.DEBUG, format=\'%(asctime)s %(message)s\')\n\nlogging.info(\'Connecting to Teradata\');\n\n\n'}, 'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 122, 'commandId': 8801006436713092}], 'id': 1}}}}}, 'buffers': []})
2025-11-14 07:26:46,996 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'd69babba-f91e-4612-8832-de058c81fa51', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 26, 46, 947000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'd69babba-f91e-4612-8832-de058c81fa51', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}], 'editedCommandId': 8801006436713092, 'contentChanges': [{'range': {'start': {'line': 121, 'character': 0}, 'end': {'line': 122, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 121, 'character': 0}, 'end': {'line': 121, 'character': 0}}, 'text': "# Database credentials for UDH\nudh_username = 'app_noc_daily_ops_call'\nudh_pass = 'SBhe09r7h20gsav'\n\n# Connect to UDH (Redshift)\nlogging.info('Connecting to UDH')\nprint('Connecting to UDH')\n\ntry:\n    udh_connection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host='cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com',\n        dbname='udhprod',\n        port=5439\n    )\n    logging.info('UDH connection successful')\nexcept Exception as e:\n    logging.error(f'UDH connection failed: {str(e)}')\n    raise\n"}], 'cursorPosition': {'line': 140, 'character': 9}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 3}, 'id': 2}}}}}, 'buffers': []})
2025-11-14 07:26:48,738 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '116064fb-336d-42df-b660-16aa619a5c2a', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 26, 48, 688000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '116064fb-336d-42df-b660-16aa619a5c2a', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didOpen', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'text': 'from databricks.sdk.runtime import display, displayHTML, getArgument, sc, spark, sql, sqlContext, table, udf;from dbruntime.dbutils import DBUtils as dbutils;from IPython import get_ipython;In={};Out={};_ih=[];_oh={};_dh=[];_=None;__=None;___=None;_i=None;_ii=None;_sqldf=spark.createDataFrame([], schema=[])\n# %pip install "sqlalchemy<2.0"\ndbutils.library.restartPython()\n\nmode = \'PROD\'\n\n\n\nimport pandas as pd\nimport datetime\nimport logging\nimport os\nimport pyodbc\nimport smtplib as smtp\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.text import MIMEText\n\nfrom email.utils import formataddr\nfrom email.header import Header\nfrom email import encoders\nfrom email.mime.base import MIMEBase\nfrom email.mime.application import MIMEApplication\nfrom email.mime.image import MIMEImage\nimport urllib.parse\nfrom sqlalchemy import create_engine, text\nimport re\nfrom random import *\nimport psycopg2\nos.chdir(r\'/Workspace/Ops Analysis/Reports/745 express weekly\')\nTODAY = datetime.datetime.today().strftime(\'%Y%m%d\')\nYES = datetime.date.today() - datetime.timedelta(days=1)\nLW = datetime.date.today() - datetime.timedelta(days=7)\nYESTERDAY = YES.strftime(\'%m/%d/%Y\')\nLWDATE = LW.strftime(\'%m/%d/%Y\')\nYEST = YES.strftime(\'%Y-%m-%d\')\n\nif mode == \'PROD\':\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr.csv\'\nelse:\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr_test.csv\'\n    \nLOG_FILE_NAME = os.getcwd() + r\'/logs/\' + datetime.datetime.today().strftime(\'%Y%m%d %H%M%S\') + \'.log\'\nCSV_FLDR = os.getcwd() + r\'/CSV/\'\nSQL_FOLDER = os.getcwd() + r\'/SQL\'\nXLSX_FLDR = os.getcwd() + r\'/XLSX/\'\nHTML_FLDR = os.getcwd() + r\'/HTML/\'\nPNG_FLDR = os.getcwd() + r\'/DailyImages/\'\nfilename_attach = os.getcwd() + r\'/0745_UAX_WB_Flights.xlsm\'\nPDF_FLDR = os.getcwd() + r\'/PDF/\'\nfilename = os.getcwd() + r\'/0745_UAX_WB_final_v1.xlsm\'\n\nCID1 =  \'1\'\nCID2 =  \'2\'\n\n\nHTML_BDY_FILE_PATH = HTML_FLDR + r\'EmailBody.htm\'\nHTML_FTR_FILE_PATH = HTML_FLDR + r\'EmailFooter.htm\'\n\nXLS_FILE_PATH = XLSX_FLDR + YEST + r\' 0745 UAX Flight details.xlsm\'\n\nXLS_FILE_NAME = YEST + r\' 0745 Weekly UAX Flight details.xlsm\'\n\nEDW_SQL_1= SQL_FOLDER + r\'/UA_SQL_1.sql\'\nEDW_SQL_2= SQL_FOLDER +r\'/CNXL_SQL_2.sql\'\nEDW_SQL_3= SQL_FOLDER +r\'/RES_CNXL_SQL_3.sql\'\nEDW_SQL_4= SQL_FOLDER +r\'/SCH_DEP_SQL_4.sql\'\nEDW_SQL_5= SQL_FOLDER +r\'/DIVERTS_SQL_5.sql\'\nEDW_SQL_6= SQL_FOLDER +r\'/RECOVERED_DIVERTS_SQL_6.sql\'\nEDW_SQL_7= SQL_FOLDER +r\'/UA_HUB_SQL_7.sql\'\nEDW_SQL_8= SQL_FOLDER +r\'/FLIGHTS_NOT_DEPARTED_SQL_8.sql\'\n\nEDW_SQL_9= SQL_FOLDER +r\'/Cancelled_flights_SQL_9.sql\' ## Converted\nEDW_SQL_10= SQL_FOLDER +r\'/Yet_to_Depart_flights_SQL_10.sql\'\nEDW_SQL_11= SQL_FOLDER +r\'/Residual_cancels_SQL_11.sql\' ## Converted\nEDW_SQL_12= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_SQL_12.sql\'\n\nEDW_SQL_13= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_COUNT_SQL_13.sql\'\nEDW_SQL_14= SQL_FOLDER +r\'/Diverted_flights_SQL_14.sql\'\nEDW_SQL_15 = SQL_FOLDER + r\'/UA_Line.sql\'\nEDW_SQL_16 = SQL_FOLDER + r\'/UA_Seat_Cancels.sql\'\nEDW_SQL_17 = SQL_FOLDER + r\'/Carrier_delays.sql\'\nEDW_SQL_18= SQL_FOLDER +r\'/Delays_info.sql\'\n\n\n\nMF_SQL_1= SQL_FOLDER +r\'/OA_SQL_1.sql\'\nMF_SQL_2= SQL_FOLDER +r\'/OA_SQL_2.sql\'\nMF_SQL_3= SQL_FOLDER +r\'/OA_Line.sql\'\nMF_SQL_4= SQL_FOLDER +r\'/OA_SeatCnxl.sql\'\nUA_SQL_1_CSV_FILE = CSV_FLDR + r\'UA_SQL_1_\' +TODAY+\'.csv\'\nCNXL_SQL_2_CSV_FILE = CSV_FLDR + r\'CNXL_SQL_2_\' +TODAY+\'.csv\'\nRES_CNXL_SQL_3_CSV_FILE = CSV_FLDR + r\'RES_CNXL_SQL_3_\' +TODAY+\'.csv\'\nSCH_DEP_SQL_4_CSV_FILE = CSV_FLDR + r\'SCH_DEP_SQL_4_\' +TODAY+\'.csv\'\nDIVERTS_SQL_5_CSV_FILE = CSV_FLDR + r\'DIVERTS_SQL_5_\' +TODAY+\'.csv\'\nRECOVERED_DIVERTS_SQL_6_CSV_FILE = CSV_FLDR + r\'RECOVERED_DIVERTS_SQL_6_\' +TODAY+\'.csv\'\nUA_HUB_SQL_7_CSV_FILE = CSV_FLDR + r\'UA_HUB_SQL_7_\' +TODAY+\'.csv\'\nFLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE = CSV_FLDR + r\'FLIGHTS_NOT_DEPARTED_SQL_8_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_COUNT_SQL_13_\' +TODAY+\'.csv\'\nCancelled_flights_SQL_9_CSV_FILE = CSV_FLDR + r\'Cancelled_flights_SQL_9_\' +TODAY+\'.csv\'\nYet_to_Depart_flights_SQL_10_CSV_FILE = CSV_FLDR + r\'Yet_to_Depart_flights_SQL_10_\' +TODAY+\'.csv\'\nResidual_cancels_SQL_11_CSV_FILE = CSV_FLDR + r\'Residual_cancels_SQL_11_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_SQL_12_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_SQL_12_\' +TODAY+\'.csv\'\nDIVERTED_FLIGHTS_SQL_14_CSV_FILE = CSV_FLDR + r\'Diverted_flights_SQL_14\' +TODAY+\'.csv\'\nUA_Line_CSV_FILE = CSV_FLDR + r\'UA_Line\' +TODAY+\'.csv\'\nUA_Seat_Cancels_CSV_FILE = CSV_FLDR + r\'UA_Seat_Cancels\' +TODAY+\'.csv\'\nDELAYS_INFO_CSV_FILE = CSV_FLDR + r\'Delays_info\' +TODAY+\'.csv\'\nCarrier_delays_CSV_FILE = CSV_FLDR + r\'Carrier_delays\' +TODAY+\'.csv\'\nOA_SQL_1_CSV_FILE = CSV_FLDR + r\'OA_SQL_1_\' +TODAY+\'.csv\'\nOA_SQL_2_CSV_FILE = CSV_FLDR + r\'OA_SQL_2_\' +TODAY+\'.csv\'\nOA_Line_CSV_FILE = CSV_FLDR + r\'OA_Line_\' +TODAY+\'.csv\'\nOA_SeatCnxl_CSV_FILE = CSV_FLDR + r\'OA_SeatCnxl_\' +TODAY+\'.csv\'\nPNG_FILE_SYS1 = PNG_FLDR + TODAY + r\' pg1.png\'\nXLS_SHT_SYS1 = \'pg1\'\nPNG_FILE_SYS2 = PNG_FLDR + TODAY + r\' pg2.png\'\nXLS_SHT_SYS2 = \'pg2\'\nPDF_FILE_PATH = PDF_FLDR + YEST + r\'_745_UAX\' +\'.pdf\'\n\nlogging.basicConfig(filename=LOG_FILE_NAME, level=logging.DEBUG, format=\'%(asctime)s %(message)s\')\n\nlogging.info(\'Connecting to Teradata\');\n\n# Database credentials for UDH\nudh_username = \'app_noc_daily_ops_call\'\nudh_pass = \'SBhe09r7h20gsav\'\n\n# Connect to UDH (Redshift)\nlogging.info(\'Connecting to UDH\')\nprint(\'Connecting to UDH\')\n\ntry:\n    udh_connection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host=\'cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com\',\n        dbname=\'udhprod\',\n        port=5439\n    )\n    logging.info(\'UDH connection successful\')\nexcept Exception as e:\n    logging.error(f\'UDH connection failed: {str(e)}\')\n    raise\n'}, 'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}], 'id': 3}}}}}, 'buffers': []})
2025-11-14 07:26:57,126 Received command c on object id p0
2025-11-14 07:26:57,138 Connecting to UDH
2025-11-14 07:26:57,226 UDH connection successful
2025-11-14 07:26:59,715 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '24e1896a-e70a-4b7c-a292-4cfdcf8f28f7', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 26, 59, 659000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '24e1896a-e70a-4b7c-a292-4cfdcf8f28f7', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didOpen', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'languageId': 'python', 'version': 1, 'text': 'from databricks.sdk.runtime import display, displayHTML, getArgument, sc, spark, sql, sqlContext, table, udf;from dbruntime.dbutils import DBUtils as dbutils;from IPython import get_ipython;In={};Out={};_ih=[];_oh={};_dh=[];_=None;__=None;___=None;_i=None;_ii=None;_sqldf=spark.createDataFrame([], schema=[])\n# %pip install "sqlalchemy<2.0"\ndbutils.library.restartPython()\n\nmode = \'PROD\'\n\n\n\nimport pandas as pd\nimport datetime\nimport logging\nimport os\nimport pyodbc\nimport smtplib as smtp\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.text import MIMEText\n\nfrom email.utils import formataddr\nfrom email.header import Header\nfrom email import encoders\nfrom email.mime.base import MIMEBase\nfrom email.mime.application import MIMEApplication\nfrom email.mime.image import MIMEImage\nimport urllib.parse\nfrom sqlalchemy import create_engine, text\nimport re\nfrom random import *\nimport psycopg2\nos.chdir(r\'/Workspace/Ops Analysis/Reports/745 express weekly\')\nTODAY = datetime.datetime.today().strftime(\'%Y%m%d\')\nYES = datetime.date.today() - datetime.timedelta(days=1)\nLW = datetime.date.today() - datetime.timedelta(days=7)\nYESTERDAY = YES.strftime(\'%m/%d/%Y\')\nLWDATE = LW.strftime(\'%m/%d/%Y\')\nYEST = YES.strftime(\'%Y-%m-%d\')\n\nif mode == \'PROD\':\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr.csv\'\nelse:\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr_test.csv\'\n    \nLOG_FILE_NAME = os.getcwd() + r\'/logs/\' + datetime.datetime.today().strftime(\'%Y%m%d %H%M%S\') + \'.log\'\nCSV_FLDR = os.getcwd() + r\'/CSV/\'\nSQL_FOLDER = os.getcwd() + r\'/SQL\'\nXLSX_FLDR = os.getcwd() + r\'/XLSX/\'\nHTML_FLDR = os.getcwd() + r\'/HTML/\'\nPNG_FLDR = os.getcwd() + r\'/DailyImages/\'\nfilename_attach = os.getcwd() + r\'/0745_UAX_WB_Flights.xlsm\'\nPDF_FLDR = os.getcwd() + r\'/PDF/\'\nfilename = os.getcwd() + r\'/0745_UAX_WB_final_v1.xlsm\'\n\nCID1 =  \'1\'\nCID2 =  \'2\'\n\n\nHTML_BDY_FILE_PATH = HTML_FLDR + r\'EmailBody.htm\'\nHTML_FTR_FILE_PATH = HTML_FLDR + r\'EmailFooter.htm\'\n\nXLS_FILE_PATH = XLSX_FLDR + YEST + r\' 0745 UAX Flight details.xlsm\'\n\nXLS_FILE_NAME = YEST + r\' 0745 Weekly UAX Flight details.xlsm\'\n\nEDW_SQL_1= SQL_FOLDER + r\'/UA_SQL_1.sql\'\nEDW_SQL_2= SQL_FOLDER +r\'/CNXL_SQL_2.sql\'\nEDW_SQL_3= SQL_FOLDER +r\'/RES_CNXL_SQL_3.sql\'\nEDW_SQL_4= SQL_FOLDER +r\'/SCH_DEP_SQL_4.sql\'\nEDW_SQL_5= SQL_FOLDER +r\'/DIVERTS_SQL_5.sql\'\nEDW_SQL_6= SQL_FOLDER +r\'/RECOVERED_DIVERTS_SQL_6.sql\'\nEDW_SQL_7= SQL_FOLDER +r\'/UA_HUB_SQL_7.sql\'\nEDW_SQL_8= SQL_FOLDER +r\'/FLIGHTS_NOT_DEPARTED_SQL_8.sql\'\n\nEDW_SQL_9= SQL_FOLDER +r\'/Cancelled_flights_SQL_9.sql\' ## Converted\nEDW_SQL_10= SQL_FOLDER +r\'/Yet_to_Depart_flights_SQL_10.sql\'\nEDW_SQL_11= SQL_FOLDER +r\'/Residual_cancels_SQL_11.sql\' ## Converted\nEDW_SQL_12= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_SQL_12.sql\'\n\nEDW_SQL_13= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_COUNT_SQL_13.sql\'\nEDW_SQL_14= SQL_FOLDER +r\'/Diverted_flights_SQL_14.sql\'\nEDW_SQL_15 = SQL_FOLDER + r\'/UA_Line.sql\'\nEDW_SQL_16 = SQL_FOLDER + r\'/UA_Seat_Cancels.sql\'\nEDW_SQL_17 = SQL_FOLDER + r\'/Carrier_delays.sql\'\nEDW_SQL_18= SQL_FOLDER +r\'/Delays_info.sql\'\n\n\n\nMF_SQL_1= SQL_FOLDER +r\'/OA_SQL_1.sql\'\nMF_SQL_2= SQL_FOLDER +r\'/OA_SQL_2.sql\'\nMF_SQL_3= SQL_FOLDER +r\'/OA_Line.sql\'\nMF_SQL_4= SQL_FOLDER +r\'/OA_SeatCnxl.sql\'\nUA_SQL_1_CSV_FILE = CSV_FLDR + r\'UA_SQL_1_\' +TODAY+\'.csv\'\nCNXL_SQL_2_CSV_FILE = CSV_FLDR + r\'CNXL_SQL_2_\' +TODAY+\'.csv\'\nRES_CNXL_SQL_3_CSV_FILE = CSV_FLDR + r\'RES_CNXL_SQL_3_\' +TODAY+\'.csv\'\nSCH_DEP_SQL_4_CSV_FILE = CSV_FLDR + r\'SCH_DEP_SQL_4_\' +TODAY+\'.csv\'\nDIVERTS_SQL_5_CSV_FILE = CSV_FLDR + r\'DIVERTS_SQL_5_\' +TODAY+\'.csv\'\nRECOVERED_DIVERTS_SQL_6_CSV_FILE = CSV_FLDR + r\'RECOVERED_DIVERTS_SQL_6_\' +TODAY+\'.csv\'\nUA_HUB_SQL_7_CSV_FILE = CSV_FLDR + r\'UA_HUB_SQL_7_\' +TODAY+\'.csv\'\nFLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE = CSV_FLDR + r\'FLIGHTS_NOT_DEPARTED_SQL_8_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_COUNT_SQL_13_\' +TODAY+\'.csv\'\nCancelled_flights_SQL_9_CSV_FILE = CSV_FLDR + r\'Cancelled_flights_SQL_9_\' +TODAY+\'.csv\'\nYet_to_Depart_flights_SQL_10_CSV_FILE = CSV_FLDR + r\'Yet_to_Depart_flights_SQL_10_\' +TODAY+\'.csv\'\nResidual_cancels_SQL_11_CSV_FILE = CSV_FLDR + r\'Residual_cancels_SQL_11_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_SQL_12_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_SQL_12_\' +TODAY+\'.csv\'\nDIVERTED_FLIGHTS_SQL_14_CSV_FILE = CSV_FLDR + r\'Diverted_flights_SQL_14\' +TODAY+\'.csv\'\nUA_Line_CSV_FILE = CSV_FLDR + r\'UA_Line\' +TODAY+\'.csv\'\nUA_Seat_Cancels_CSV_FILE = CSV_FLDR + r\'UA_Seat_Cancels\' +TODAY+\'.csv\'\nDELAYS_INFO_CSV_FILE = CSV_FLDR + r\'Delays_info\' +TODAY+\'.csv\'\nCarrier_delays_CSV_FILE = CSV_FLDR + r\'Carrier_delays\' +TODAY+\'.csv\'\nOA_SQL_1_CSV_FILE = CSV_FLDR + r\'OA_SQL_1_\' +TODAY+\'.csv\'\nOA_SQL_2_CSV_FILE = CSV_FLDR + r\'OA_SQL_2_\' +TODAY+\'.csv\'\nOA_Line_CSV_FILE = CSV_FLDR + r\'OA_Line_\' +TODAY+\'.csv\'\nOA_SeatCnxl_CSV_FILE = CSV_FLDR + r\'OA_SeatCnxl_\' +TODAY+\'.csv\'\nPNG_FILE_SYS1 = PNG_FLDR + TODAY + r\' pg1.png\'\nXLS_SHT_SYS1 = \'pg1\'\nPNG_FILE_SYS2 = PNG_FLDR + TODAY + r\' pg2.png\'\nXLS_SHT_SYS2 = \'pg2\'\nPDF_FILE_PATH = PDF_FLDR + YEST + r\'_745_UAX\' +\'.pdf\'\n\nlogging.basicConfig(filename=LOG_FILE_NAME, level=logging.DEBUG, format=\'%(asctime)s %(message)s\')\n\nlogging.info(\'Connecting to Teradata\');\n\n# Database credentials for UDH\nudh_username = \'app_noc_daily_ops_call\'\nudh_pass = \'SBhe09r7h20gsav\'\n\n# Connect to UDH (Redshift)\nlogging.info(\'Connecting to UDH\')\nprint(\'Connecting to UDH\')\n\ntry:\n    udh_connection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host=\'cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com\',\n        dbname=\'udhprod\',\n        port=5439\n    )\n    logging.info(\'UDH connection successful\')\nexcept Exception as e:\n    logging.error(f\'UDH connection failed: {str(e)}\')\n    raise\n\n'}, 'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 142}], 'id': 4}}}}}, 'buffers': []})
2025-11-14 07:26:59,812 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'c94c6757-e716-467d-915f-82ab380f0639', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 26, 59, 765000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'c94c6757-e716-467d-915f-82ab380f0639', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 142}], 'contentChanges': [{'range': {'start': {'line': 141, 'character': 0}, 'end': {'line': 142, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 141, 'character': 0}, 'end': {'line': 141, 'character': 0}}, 'text': '\n'}], 'cursorPosition': {'line': 141, 'character': 0}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 2}, 'id': 5}}}}}, 'buffers': []})
2025-11-14 07:27:00,929 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '384103bc-d113-4359-8329-a47cb625a1f9', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 27, 0, 865000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '384103bc-d113-4359-8329-a47cb625a1f9', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didOpen', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'text': 'from databricks.sdk.runtime import display, displayHTML, getArgument, sc, spark, sql, sqlContext, table, udf;from dbruntime.dbutils import DBUtils as dbutils;from IPython import get_ipython;In={};Out={};_ih=[];_oh={};_dh=[];_=None;__=None;___=None;_i=None;_ii=None;_sqldf=spark.createDataFrame([], schema=[])\n# %pip install "sqlalchemy<2.0"\ndbutils.library.restartPython()\n\nmode = \'PROD\'\n\n\n\nimport pandas as pd\nimport datetime\nimport logging\nimport os\nimport pyodbc\nimport smtplib as smtp\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.text import MIMEText\n\nfrom email.utils import formataddr\nfrom email.header import Header\nfrom email import encoders\nfrom email.mime.base import MIMEBase\nfrom email.mime.application import MIMEApplication\nfrom email.mime.image import MIMEImage\nimport urllib.parse\nfrom sqlalchemy import create_engine, text\nimport re\nfrom random import *\nimport psycopg2\nos.chdir(r\'/Workspace/Ops Analysis/Reports/745 express weekly\')\nTODAY = datetime.datetime.today().strftime(\'%Y%m%d\')\nYES = datetime.date.today() - datetime.timedelta(days=1)\nLW = datetime.date.today() - datetime.timedelta(days=7)\nYESTERDAY = YES.strftime(\'%m/%d/%Y\')\nLWDATE = LW.strftime(\'%m/%d/%Y\')\nYEST = YES.strftime(\'%Y-%m-%d\')\n\nif mode == \'PROD\':\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr.csv\'\nelse:\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr_test.csv\'\n    \nLOG_FILE_NAME = os.getcwd() + r\'/logs/\' + datetime.datetime.today().strftime(\'%Y%m%d %H%M%S\') + \'.log\'\nCSV_FLDR = os.getcwd() + r\'/CSV/\'\nSQL_FOLDER = os.getcwd() + r\'/SQL\'\nXLSX_FLDR = os.getcwd() + r\'/XLSX/\'\nHTML_FLDR = os.getcwd() + r\'/HTML/\'\nPNG_FLDR = os.getcwd() + r\'/DailyImages/\'\nfilename_attach = os.getcwd() + r\'/0745_UAX_WB_Flights.xlsm\'\nPDF_FLDR = os.getcwd() + r\'/PDF/\'\nfilename = os.getcwd() + r\'/0745_UAX_WB_final_v1.xlsm\'\n\nCID1 =  \'1\'\nCID2 =  \'2\'\n\n\nHTML_BDY_FILE_PATH = HTML_FLDR + r\'EmailBody.htm\'\nHTML_FTR_FILE_PATH = HTML_FLDR + r\'EmailFooter.htm\'\n\nXLS_FILE_PATH = XLSX_FLDR + YEST + r\' 0745 UAX Flight details.xlsm\'\n\nXLS_FILE_NAME = YEST + r\' 0745 Weekly UAX Flight details.xlsm\'\n\nEDW_SQL_1= SQL_FOLDER + r\'/UA_SQL_1.sql\'\nEDW_SQL_2= SQL_FOLDER +r\'/CNXL_SQL_2.sql\'\nEDW_SQL_3= SQL_FOLDER +r\'/RES_CNXL_SQL_3.sql\'\nEDW_SQL_4= SQL_FOLDER +r\'/SCH_DEP_SQL_4.sql\'\nEDW_SQL_5= SQL_FOLDER +r\'/DIVERTS_SQL_5.sql\'\nEDW_SQL_6= SQL_FOLDER +r\'/RECOVERED_DIVERTS_SQL_6.sql\'\nEDW_SQL_7= SQL_FOLDER +r\'/UA_HUB_SQL_7.sql\'\nEDW_SQL_8= SQL_FOLDER +r\'/FLIGHTS_NOT_DEPARTED_SQL_8.sql\'\n\nEDW_SQL_9= SQL_FOLDER +r\'/Cancelled_flights_SQL_9.sql\' ## Converted\nEDW_SQL_10= SQL_FOLDER +r\'/Yet_to_Depart_flights_SQL_10.sql\'\nEDW_SQL_11= SQL_FOLDER +r\'/Residual_cancels_SQL_11.sql\' ## Converted\nEDW_SQL_12= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_SQL_12.sql\'\n\nEDW_SQL_13= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_COUNT_SQL_13.sql\'\nEDW_SQL_14= SQL_FOLDER +r\'/Diverted_flights_SQL_14.sql\'\nEDW_SQL_15 = SQL_FOLDER + r\'/UA_Line.sql\'\nEDW_SQL_16 = SQL_FOLDER + r\'/UA_Seat_Cancels.sql\'\nEDW_SQL_17 = SQL_FOLDER + r\'/Carrier_delays.sql\'\nEDW_SQL_18= SQL_FOLDER +r\'/Delays_info.sql\'\n\n\n\nMF_SQL_1= SQL_FOLDER +r\'/OA_SQL_1.sql\'\nMF_SQL_2= SQL_FOLDER +r\'/OA_SQL_2.sql\'\nMF_SQL_3= SQL_FOLDER +r\'/OA_Line.sql\'\nMF_SQL_4= SQL_FOLDER +r\'/OA_SeatCnxl.sql\'\nUA_SQL_1_CSV_FILE = CSV_FLDR + r\'UA_SQL_1_\' +TODAY+\'.csv\'\nCNXL_SQL_2_CSV_FILE = CSV_FLDR + r\'CNXL_SQL_2_\' +TODAY+\'.csv\'\nRES_CNXL_SQL_3_CSV_FILE = CSV_FLDR + r\'RES_CNXL_SQL_3_\' +TODAY+\'.csv\'\nSCH_DEP_SQL_4_CSV_FILE = CSV_FLDR + r\'SCH_DEP_SQL_4_\' +TODAY+\'.csv\'\nDIVERTS_SQL_5_CSV_FILE = CSV_FLDR + r\'DIVERTS_SQL_5_\' +TODAY+\'.csv\'\nRECOVERED_DIVERTS_SQL_6_CSV_FILE = CSV_FLDR + r\'RECOVERED_DIVERTS_SQL_6_\' +TODAY+\'.csv\'\nUA_HUB_SQL_7_CSV_FILE = CSV_FLDR + r\'UA_HUB_SQL_7_\' +TODAY+\'.csv\'\nFLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE = CSV_FLDR + r\'FLIGHTS_NOT_DEPARTED_SQL_8_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_COUNT_SQL_13_\' +TODAY+\'.csv\'\nCancelled_flights_SQL_9_CSV_FILE = CSV_FLDR + r\'Cancelled_flights_SQL_9_\' +TODAY+\'.csv\'\nYet_to_Depart_flights_SQL_10_CSV_FILE = CSV_FLDR + r\'Yet_to_Depart_flights_SQL_10_\' +TODAY+\'.csv\'\nResidual_cancels_SQL_11_CSV_FILE = CSV_FLDR + r\'Residual_cancels_SQL_11_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_SQL_12_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_SQL_12_\' +TODAY+\'.csv\'\nDIVERTED_FLIGHTS_SQL_14_CSV_FILE = CSV_FLDR + r\'Diverted_flights_SQL_14\' +TODAY+\'.csv\'\nUA_Line_CSV_FILE = CSV_FLDR + r\'UA_Line\' +TODAY+\'.csv\'\nUA_Seat_Cancels_CSV_FILE = CSV_FLDR + r\'UA_Seat_Cancels\' +TODAY+\'.csv\'\nDELAYS_INFO_CSV_FILE = CSV_FLDR + r\'Delays_info\' +TODAY+\'.csv\'\nCarrier_delays_CSV_FILE = CSV_FLDR + r\'Carrier_delays\' +TODAY+\'.csv\'\nOA_SQL_1_CSV_FILE = CSV_FLDR + r\'OA_SQL_1_\' +TODAY+\'.csv\'\nOA_SQL_2_CSV_FILE = CSV_FLDR + r\'OA_SQL_2_\' +TODAY+\'.csv\'\nOA_Line_CSV_FILE = CSV_FLDR + r\'OA_Line_\' +TODAY+\'.csv\'\nOA_SeatCnxl_CSV_FILE = CSV_FLDR + r\'OA_SeatCnxl_\' +TODAY+\'.csv\'\nPNG_FILE_SYS1 = PNG_FLDR + TODAY + r\' pg1.png\'\nXLS_SHT_SYS1 = \'pg1\'\nPNG_FILE_SYS2 = PNG_FLDR + TODAY + r\' pg2.png\'\nXLS_SHT_SYS2 = \'pg2\'\nPDF_FILE_PATH = PDF_FLDR + YEST + r\'_745_UAX\' +\'.pdf\'\n\nlogging.basicConfig(filename=LOG_FILE_NAME, level=logging.DEBUG, format=\'%(asctime)s %(message)s\')\n\nlogging.info(\'Connecting to Teradata\');\n\n# Database credentials for UDH\nudh_username = \'app_noc_daily_ops_call\'\nudh_pass = \'SBhe09r7h20gsav\'\n\n# Connect to UDH (Redshift)\nlogging.info(\'Connecting to UDH\')\nprint(\'Connecting to UDH\')\n\ntry:\n    udh_connection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host=\'cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com\',\n        dbname=\'udhprod\',\n        port=5439\n    )\n    logging.info(\'UDH connection successful\')\nexcept Exception as e:\n    logging.error(f\'UDH connection failed: {str(e)}\')\n    raise\n\n'}, 'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 142, 'commandId': 8801006436713094}], 'id': 6}}}}}, 'buffers': []})
2025-11-14 07:27:31,483 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'ec9a3851-1db2-4d6e-9199-e10be92524a9', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 27, 31, 421000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'ec9a3851-1db2-4d6e-9199-e10be92524a9', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}], 'editedCommandId': 8801006436713094, 'contentChanges': [{'range': {'start': {'line': 141, 'character': 0}, 'end': {'line': 142, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 141, 'character': 0}, 'end': {'line': 141, 'character': 0}}, 'text': "\ne1 = open(EDW_SQL_1, 'r')\nsqlEdw1 = e1.read()\ne1.close()\n\ne2 = open(EDW_SQL_2, 'r')\nsqlEdw2 = e2.read()\ne2.close()\n\ne3 = open(EDW_SQL_3, 'r')\nsqlEdw3 = e3.read()\ne3.close()\n\ne4 = open(EDW_SQL_4, 'r')\nsqlEdw4 = e4.read()\ne4.close()\n\ne5 = open(EDW_SQL_5, 'r')\nsqlEdw5 = e5.read()\ne5.close()\n\ne6 = open(EDW_SQL_6, 'r')\nsqlEdw6 = e6.read()\ne6.close()\n\ne7 = open(EDW_SQL_7, 'r')\nsqlEdw7 = e7.read()\ne7.close()\n\ne8 = open(EDW_SQL_8, 'r')\nsqlEdw8 = e8.read()\ne8.close()\n\ne9 = open(EDW_SQL_9, 'r')\nsqlEdw9 = e9.read()\ne9.close()\n\ne10 = open(EDW_SQL_10, 'r')\nsqlEdw10 = e10.read()\ne10.close()\n\ne11 = open(EDW_SQL_11, 'r')\nsqlEdw11 = e11.read()\ne11.close()\n\ne12 = open(EDW_SQL_12, 'r')\nsqlEdw12 = e12.read()\ne12.close()\n\ne13 = open(EDW_SQL_13, 'r')\nsqlEdw13 = e13.read()\ne13.close()\n\ne14 = open(EDW_SQL_14, 'r')\nsqlEdw14 = e14.read()\ne14.close()\n\ne15 = open(EDW_SQL_15, 'r')\nsqlEdw15 = e15.read()\ne15.close()\n\ne16 = open(EDW_SQL_16, 'r')\nsqlEdw16 = e16.read()\ne16.close()\n\ne17 = open(EDW_SQL_17, 'r')\nsqlEdw17 = e17.read()\ne17.close()\n\ne18 = open(EDW_SQL_18, 'r')\nsqlEdw18 = e18.read()\ne18.close()\n\n"}], 'cursorPosition': {'line': 213, 'character': 0}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 3}, 'id': 7}}}}}, 'buffers': []})
2025-11-14 07:27:33,857 Received command c on object id p0
2025-11-14 07:27:37,123 Command to send: c
o397
get
sspark.databricks.driver.ipykernel.maxErrorMessageLength
s100000
e

2025-11-14 07:27:37,123 Error while sending or receiving.
Traceback (most recent call last):
  File "/databricks/python/lib/python3.10/site-packages/IPython/core/interactiveshell.py", line 3508, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File "/root/.ipykernel/2222/command-8801006436713094-1901923248", line 61, in <module>
    e16 = open(EDW_SQL_16, 'r')
  File "/databricks/python/lib/python3.10/site-packages/IPython/core/interactiveshell.py", line 284, in _modified_open
    return io_open(file, *args, **kwargs)
FileNotFoundError: [Errno 2] No such file or directory: '/Workspace/Ops Analysis/Reports/745 express weekly/SQL/UA_Seat_Cancels.sql'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 528, in send_command
    self.socket.sendall(command.encode("utf-8"))
ConnectionResetError: [Errno 104] Connection reset by peer
2025-11-14 07:27:37,124 Closing down clientserver connection
2025-11-14 07:27:37,124 Exception while shutting down a socket
Traceback (most recent call last):
  File "/databricks/python/lib/python3.10/site-packages/IPython/core/interactiveshell.py", line 3508, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File "/root/.ipykernel/2222/command-8801006436713094-1901923248", line 61, in <module>
    e16 = open(EDW_SQL_16, 'r')
  File "/databricks/python/lib/python3.10/site-packages/IPython/core/interactiveshell.py", line 284, in _modified_open
    return io_open(file, *args, **kwargs)
FileNotFoundError: [Errno 2] No such file or directory: '/Workspace/Ops Analysis/Reports/745 express weekly/SQL/UA_Seat_Cancels.sql'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 528, in send_command
    self.socket.sendall(command.encode("utf-8"))
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 1038, in send_command
    response = connection.send_command(command)
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 531, in send_command
    raise Py4JNetworkError(
py4j.protocol.Py4JNetworkError: Error while sending

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 503, in quiet_shutdown
    socket_instance.shutdown(socket.SHUT_RDWR)
OSError: [Errno 107] Transport endpoint is not connected
2025-11-14 07:27:37,126 Exception while sending command.
Traceback (most recent call last):
  File "/databricks/python/lib/python3.10/site-packages/IPython/core/interactiveshell.py", line 3508, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File "/root/.ipykernel/2222/command-8801006436713094-1901923248", line 61, in <module>
    e16 = open(EDW_SQL_16, 'r')
  File "/databricks/python/lib/python3.10/site-packages/IPython/core/interactiveshell.py", line 284, in _modified_open
    return io_open(file, *args, **kwargs)
FileNotFoundError: [Errno 2] No such file or directory: '/Workspace/Ops Analysis/Reports/745 express weekly/SQL/UA_Seat_Cancels.sql'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 528, in send_command
    self.socket.sendall(command.encode("utf-8"))
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 1038, in send_command
    response = connection.send_command(command)
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 531, in send_command
    raise Py4JNetworkError(
py4j.protocol.Py4JNetworkError: Error while sending
2025-11-14 07:27:37,126 Command to send: A
1e5d8e39e11ea7b92ba7095e3af7a4c598aba5612781472207af95c4223e9e25

2025-11-14 07:27:37,129 Answer received: !yv
2025-11-14 07:27:37,130 Command to send: c
o397
get
sspark.databricks.driver.ipykernel.maxErrorMessageLength
s100000
e

2025-11-14 07:27:37,131 Answer received: !ys100000
2025-11-14 07:27:37,131 Closing down clientserver connection
2025-11-14 07:27:37,132 Command to send: c
o397
get
sspark.databricks.driver.ipykernel.maxErrorMessageLength
s100000
e

2025-11-14 07:27:37,137 Answer received: !ys100000
2025-11-14 07:28:27,295 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '36a86762-f2bf-4db2-910b-99ad6b8966c6', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 28, 27, 253000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '36a86762-f2bf-4db2-910b-99ad6b8966c6', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'id': 0, 'method': 'initialize', 'params': {'capabilities': {'workspace': {'applyEdit': True, 'workspaceEdit': {'failureHandling': 'textOnlyTransactional', 'documentChanges': True, 'resourceOperations': ['create', 'rename', 'delete'], 'changeAnnotationSupport': {'groupsOnLabel': True}, 'normalizesLineEndings': True}}, 'textDocument': {'publishDiagnostics': {'codeDescriptionSupport': True, 'versionSupport': False, 'tagSupport': {'valueSet': [1, 2]}, 'dataSupport': True, 'relatedInformation': True}, 'synchronization': {'dynamicRegistration': True}, 'definition': {'dynamicRegistration': True, 'linkSupport': True}, 'references': {'dynamicRegistration': True}}, 'window': {'showMessage': {'messageActionItem': {'additionalPropertiesSupport': True}}, 'showDocument': {'support': True}}, 'general': {'staleRequestSupport': {'cancel': True, 'retryOnContentModified': ['textDocument/semanticTokens/full', 'textDocument/semanticTokens/range', 'textDocument/semanticTokens/full/delta']}, 'regularExpressions': {'engine': 'ECMAScript', 'version': 'ES2020'}, 'markdown': {'parser': 'marked', 'version': '1.1.0'}, 'positionEncodings': ['utf-16']}}, 'trace': 'off', 'workspaceFolders': None, 'initializationOptions': {'dbls': {'supportedDblsVersions': []}, 'pylsp': {'plugins': {'ruff': {'enabled': True, 'select': ['E9', 'F407', 'F622', 'F701', 'F702', 'F704', 'F706', 'F82']}, 'pyflakes': {'enabled': False}, 'pylsp_ucx': {'enabled': False}, 'mccabe': {'enabled': False}, 'flake8': {'enabled': False}, 'pycodestyle': {'enabled': False}, 'preload': {'enabled': False}}}}, 'clientInfo': {'name': 'Code - OSS', 'version': '1.93.1'}, 'locale': 'en-US', 'rootUri': None, 'rootPath': None, 'processId': None}}}}}, 'buffers': []})
2025-11-14 07:28:27,654 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '2102ea0e-aedb-4a1a-8773-061079781c37', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 28, 27, 616000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '2102ea0e-aedb-4a1a-8773-061079781c37', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'initialized', 'params': {}}}}}, 'buffers': []})
2025-11-14 07:28:27,684 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'e38afeac-6d0d-4401-b7ad-997cc803cc05', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 28, 27, 619000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'e38afeac-6d0d-4401-b7ad-997cc803cc05', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didOpen', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'languageId': 'python', 'version': 22, 'text': 'from databricks.sdk.runtime import display, displayHTML, getArgument, sc, spark, sql, sqlContext, table, udf;from dbruntime.dbutils import DBUtils as dbutils;from IPython import get_ipython;In={};Out={};_ih=[];_oh={};_dh=[];_=None;__=None;___=None;_i=None;_ii=None;_sqldf=spark.createDataFrame([], schema=[])\n# %pip install "sqlalchemy<2.0"\ndbutils.library.restartPython()\n\nmode = \'PROD\'\n\n\n\nimport pandas as pd\nimport datetime\nimport logging\nimport os\nimport pyodbc\nimport smtplib as smtp\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.text import MIMEText\n\nfrom email.utils import formataddr\nfrom email.header import Header\nfrom email import encoders\nfrom email.mime.base import MIMEBase\nfrom email.mime.application import MIMEApplication\nfrom email.mime.image import MIMEImage\nimport urllib.parse\nfrom sqlalchemy import create_engine, text\nimport re\nfrom random import *\nimport psycopg2\nos.chdir(r\'/Workspace/Ops Analysis/Reports/745 express weekly\')\nTODAY = datetime.datetime.today().strftime(\'%Y%m%d\')\nYES = datetime.date.today() - datetime.timedelta(days=1)\nLW = datetime.date.today() - datetime.timedelta(days=7)\nYESTERDAY = YES.strftime(\'%m/%d/%Y\')\nLWDATE = LW.strftime(\'%m/%d/%Y\')\nYEST = YES.strftime(\'%Y-%m-%d\')\n\nif mode == \'PROD\':\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr.csv\'\nelse:\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr_test.csv\'\n    \nLOG_FILE_NAME = os.getcwd() + r\'/logs/\' + datetime.datetime.today().strftime(\'%Y%m%d %H%M%S\') + \'.log\'\nCSV_FLDR = os.getcwd() + r\'/CSV/\'\nSQL_FOLDER = os.getcwd() + r\'/SQL\'\nXLSX_FLDR = os.getcwd() + r\'/XLSX/\'\nHTML_FLDR = os.getcwd() + r\'/HTML/\'\nPNG_FLDR = os.getcwd() + r\'/DailyImages/\'\nfilename_attach = os.getcwd() + r\'/0745_UAX_WB_Flights.xlsm\'\nPDF_FLDR = os.getcwd() + r\'/PDF/\'\nfilename = os.getcwd() + r\'/0745_UAX_WB_final_v1.xlsm\'\n\nCID1 =  \'1\'\nCID2 =  \'2\'\n\n\nHTML_BDY_FILE_PATH = HTML_FLDR + r\'EmailBody.htm\'\nHTML_FTR_FILE_PATH = HTML_FLDR + r\'EmailFooter.htm\'\n\nXLS_FILE_PATH = XLSX_FLDR + YEST + r\' 0745 UAX Flight details.xlsm\'\n\nXLS_FILE_NAME = YEST + r\' 0745 Weekly UAX Flight details.xlsm\'\n\nEDW_SQL_1= SQL_FOLDER + r\'/UA_SQL_1.sql\'\nEDW_SQL_2= SQL_FOLDER +r\'/CNXL_SQL_2.sql\'\nEDW_SQL_3= SQL_FOLDER +r\'/RES_CNXL_SQL_3.sql\'\nEDW_SQL_4= SQL_FOLDER +r\'/SCH_DEP_SQL_4.sql\'\nEDW_SQL_5= SQL_FOLDER +r\'/DIVERTS_SQL_5.sql\'\nEDW_SQL_6= SQL_FOLDER +r\'/RECOVERED_DIVERTS_SQL_6.sql\'\nEDW_SQL_7= SQL_FOLDER +r\'/UA_HUB_SQL_7.sql\'\nEDW_SQL_8= SQL_FOLDER +r\'/FLIGHTS_NOT_DEPARTED_SQL_8.sql\'\n\nEDW_SQL_9= SQL_FOLDER +r\'/Cancelled_flights_SQL_9.sql\' ## Converted\nEDW_SQL_10= SQL_FOLDER +r\'/Yet_to_Depart_flights_SQL_10.sql\'\nEDW_SQL_11= SQL_FOLDER +r\'/Residual_cancels_SQL_11.sql\' ## Converted\nEDW_SQL_12= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_SQL_12.sql\'\n\nEDW_SQL_13= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_COUNT_SQL_13.sql\'\nEDW_SQL_14= SQL_FOLDER +r\'/Diverted_flights_SQL_14.sql\'\nEDW_SQL_15 = SQL_FOLDER + r\'/UA_Line.sql\'\nEDW_SQL_16 = SQL_FOLDER + r\'/UA_Seat_Cancels.sql\'\nEDW_SQL_17 = SQL_FOLDER + r\'/Carrier_delays.sql\'\nEDW_SQL_18= SQL_FOLDER +r\'/Delays_info.sql\'\n\n\n\nMF_SQL_1= SQL_FOLDER +r\'/OA_SQL_1.sql\'\nMF_SQL_2= SQL_FOLDER +r\'/OA_SQL_2.sql\'\nMF_SQL_3= SQL_FOLDER +r\'/OA_Line.sql\'\nMF_SQL_4= SQL_FOLDER +r\'/OA_SeatCnxl.sql\'\nUA_SQL_1_CSV_FILE = CSV_FLDR + r\'UA_SQL_1_\' +TODAY+\'.csv\'\nCNXL_SQL_2_CSV_FILE = CSV_FLDR + r\'CNXL_SQL_2_\' +TODAY+\'.csv\'\nRES_CNXL_SQL_3_CSV_FILE = CSV_FLDR + r\'RES_CNXL_SQL_3_\' +TODAY+\'.csv\'\nSCH_DEP_SQL_4_CSV_FILE = CSV_FLDR + r\'SCH_DEP_SQL_4_\' +TODAY+\'.csv\'\nDIVERTS_SQL_5_CSV_FILE = CSV_FLDR + r\'DIVERTS_SQL_5_\' +TODAY+\'.csv\'\nRECOVERED_DIVERTS_SQL_6_CSV_FILE = CSV_FLDR + r\'RECOVERED_DIVERTS_SQL_6_\' +TODAY+\'.csv\'\nUA_HUB_SQL_7_CSV_FILE = CSV_FLDR + r\'UA_HUB_SQL_7_\' +TODAY+\'.csv\'\nFLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE = CSV_FLDR + r\'FLIGHTS_NOT_DEPARTED_SQL_8_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_COUNT_SQL_13_\' +TODAY+\'.csv\'\nCancelled_flights_SQL_9_CSV_FILE = CSV_FLDR + r\'Cancelled_flights_SQL_9_\' +TODAY+\'.csv\'\nYet_to_Depart_flights_SQL_10_CSV_FILE = CSV_FLDR + r\'Yet_to_Depart_flights_SQL_10_\' +TODAY+\'.csv\'\nResidual_cancels_SQL_11_CSV_FILE = CSV_FLDR + r\'Residual_cancels_SQL_11_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_SQL_12_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_SQL_12_\' +TODAY+\'.csv\'\nDIVERTED_FLIGHTS_SQL_14_CSV_FILE = CSV_FLDR + r\'Diverted_flights_SQL_14\' +TODAY+\'.csv\'\nUA_Line_CSV_FILE = CSV_FLDR + r\'UA_Line\' +TODAY+\'.csv\'\nUA_Seat_Cancels_CSV_FILE = CSV_FLDR + r\'UA_Seat_Cancels\' +TODAY+\'.csv\'\nDELAYS_INFO_CSV_FILE = CSV_FLDR + r\'Delays_info\' +TODAY+\'.csv\'\nCarrier_delays_CSV_FILE = CSV_FLDR + r\'Carrier_delays\' +TODAY+\'.csv\'\nOA_SQL_1_CSV_FILE = CSV_FLDR + r\'OA_SQL_1_\' +TODAY+\'.csv\'\nOA_SQL_2_CSV_FILE = CSV_FLDR + r\'OA_SQL_2_\' +TODAY+\'.csv\'\nOA_Line_CSV_FILE = CSV_FLDR + r\'OA_Line_\' +TODAY+\'.csv\'\nOA_SeatCnxl_CSV_FILE = CSV_FLDR + r\'OA_SeatCnxl_\' +TODAY+\'.csv\'\nPNG_FILE_SYS1 = PNG_FLDR + TODAY + r\' pg1.png\'\nXLS_SHT_SYS1 = \'pg1\'\nPNG_FILE_SYS2 = PNG_FLDR + TODAY + r\' pg2.png\'\nXLS_SHT_SYS2 = \'pg2\'\nPDF_FILE_PATH = PDF_FLDR + YEST + r\'_745_UAX\' +\'.pdf\'\n\nlogging.basicConfig(filename=LOG_FILE_NAME, level=logging.DEBUG, format=\'%(asctime)s %(message)s\')\n\nlogging.info(\'Connecting to Teradata\');\n\n# Database credentials for UDH\nudh_username = \'app_noc_daily_ops_call\'\nudh_pass = \'SBhe09r7h20gsav\'\n\n# Connect to UDH (Redshift)\nlogging.info(\'Connecting to UDH\')\nprint(\'Connecting to UDH\')\n\ntry:\n    udh_connection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host=\'cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com\',\n        dbname=\'udhprod\',\n        port=5439\n    )\n    logging.info(\'UDH connection successful\')\nexcept Exception as e:\n    logging.error(f\'UDH connection failed: {str(e)}\')\n    raise\n\ne1 = open(EDW_SQL_1, \'r\')\nsqlEdw1 = e1.read()\ne1.close()\n\ne2 = open(EDW_SQL_2, \'r\')\nsqlEdw2 = e2.read()\ne2.close()\n\ne3 = open(EDW_SQL_3, \'r\')\nsqlEdw3 = e3.read()\ne3.close()\n\ne4 = open(EDW_SQL_4, \'r\')\nsqlEdw4 = e4.read()\ne4.close()\n\ne5 = open(EDW_SQL_5, \'r\')\nsqlEdw5 = e5.read()\ne5.close()\n\ne6 = open(EDW_SQL_6, \'r\')\nsqlEdw6 = e6.read()\ne6.close()\n\ne7 = open(EDW_SQL_7, \'r\')\nsqlEdw7 = e7.read()\ne7.close()\n\ne8 = open(EDW_SQL_8, \'r\')\nsqlEdw8 = e8.read()\ne8.close()\n\ne9 = open(EDW_SQL_9, \'r\')\nsqlEdw9 = e9.read()\ne9.close()\n\ne10 = open(EDW_SQL_10, \'r\')\nsqlEdw10 = e10.read()\ne10.close()\n\ne11 = open(EDW_SQL_11, \'r\')\nsqlEdw11 = e11.read()\ne11.close()\n\ne12 = open(EDW_SQL_12, \'r\')\nsqlEdw12 = e12.read()\ne12.close()\n\ne13 = open(EDW_SQL_13, \'r\')\nsqlEdw13 = e13.read()\ne13.close()\n\ne14 = open(EDW_SQL_14, \'r\')\nsqlEdw14 = e14.read()\ne14.close()\n\ne15 = open(EDW_SQL_15, \'r\')\nsqlEdw15 = e15.read()\ne15.close()\n\ne16 = open(EDW_SQL_16, \'r\')\nsqlEdw16 = e16.read()\ne16.close()\n\ne17 = open(EDW_SQL_17, \'r\')\nsqlEdw17 = e17.read()\ne17.close()\n\ne18 = open(EDW_SQL_18, \'r\')\nsqlEdw18 = e18.read()\ne18.close()\n\n'}, 'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}], 'id': 1}}}}}, 'buffers': []})
2025-11-14 07:29:00,971 Received command c on object id p0
2025-11-14 07:29:03,562 Command to send: c
o397
get
sspark.databricks.driver.ipykernel.maxErrorMessageLength
s100000
e

2025-11-14 07:29:03,563 Answer received: !ys100000
2025-11-14 07:29:03,564 Command to send: c
o397
get
sspark.databricks.driver.ipykernel.maxErrorMessageLength
s100000
e

2025-11-14 07:29:03,579 Answer received: !ys100000
2025-11-14 07:29:23,847 Received command c on object id p0
2025-11-14 07:29:30,189 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '63348c23-f21a-4408-9bff-8978a564011c', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 29, 30, 147000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '63348c23-f21a-4408-9bff-8978a564011c', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didOpen', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'languageId': 'python', 'version': 1, 'text': 'from databricks.sdk.runtime import display, displayHTML, getArgument, sc, spark, sql, sqlContext, table, udf;from dbruntime.dbutils import DBUtils as dbutils;from IPython import get_ipython;In={};Out={};_ih=[];_oh={};_dh=[];_=None;__=None;___=None;_i=None;_ii=None;_sqldf=spark.createDataFrame([], schema=[])\n# %pip install "sqlalchemy<2.0"\ndbutils.library.restartPython()\n\nmode = \'PROD\'\n\n\n\nimport pandas as pd\nimport datetime\nimport logging\nimport os\nimport pyodbc\nimport smtplib as smtp\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.text import MIMEText\n\nfrom email.utils import formataddr\nfrom email.header import Header\nfrom email import encoders\nfrom email.mime.base import MIMEBase\nfrom email.mime.application import MIMEApplication\nfrom email.mime.image import MIMEImage\nimport urllib.parse\nfrom sqlalchemy import create_engine, text\nimport re\nfrom random import *\nimport psycopg2\nos.chdir(r\'/Workspace/Ops Analysis/Reports/745 express weekly\')\nTODAY = datetime.datetime.today().strftime(\'%Y%m%d\')\nYES = datetime.date.today() - datetime.timedelta(days=1)\nLW = datetime.date.today() - datetime.timedelta(days=7)\nYESTERDAY = YES.strftime(\'%m/%d/%Y\')\nLWDATE = LW.strftime(\'%m/%d/%Y\')\nYEST = YES.strftime(\'%Y-%m-%d\')\n\nif mode == \'PROD\':\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr.csv\'\nelse:\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr_test.csv\'\n    \nLOG_FILE_NAME = os.getcwd() + r\'/logs/\' + datetime.datetime.today().strftime(\'%Y%m%d %H%M%S\') + \'.log\'\nCSV_FLDR = os.getcwd() + r\'/CSV/\'\nSQL_FOLDER = os.getcwd() + r\'/SQL\'\nXLSX_FLDR = os.getcwd() + r\'/XLSX/\'\nHTML_FLDR = os.getcwd() + r\'/HTML/\'\nPNG_FLDR = os.getcwd() + r\'/DailyImages/\'\nfilename_attach = os.getcwd() + r\'/0745_UAX_WB_Flights.xlsm\'\nPDF_FLDR = os.getcwd() + r\'/PDF/\'\nfilename = os.getcwd() + r\'/0745_UAX_WB_final_v1.xlsm\'\n\nCID1 =  \'1\'\nCID2 =  \'2\'\n\n\nHTML_BDY_FILE_PATH = HTML_FLDR + r\'EmailBody.htm\'\nHTML_FTR_FILE_PATH = HTML_FLDR + r\'EmailFooter.htm\'\n\nXLS_FILE_PATH = XLSX_FLDR + YEST + r\' 0745 UAX Flight details.xlsm\'\n\nXLS_FILE_NAME = YEST + r\' 0745 Weekly UAX Flight details.xlsm\'\n\nEDW_SQL_1= SQL_FOLDER + r\'/UA_SQL_1.sql\'\nEDW_SQL_2= SQL_FOLDER +r\'/CNXL_SQL_2.sql\'\nEDW_SQL_3= SQL_FOLDER +r\'/RES_CNXL_SQL_3.sql\'\nEDW_SQL_4= SQL_FOLDER +r\'/SCH_DEP_SQL_4.sql\'\nEDW_SQL_5= SQL_FOLDER +r\'/DIVERTS_SQL_5.sql\'\nEDW_SQL_6= SQL_FOLDER +r\'/RECOVERED_DIVERTS_SQL_6.sql\'\nEDW_SQL_7= SQL_FOLDER +r\'/UA_HUB_SQL_7.sql\'\nEDW_SQL_8= SQL_FOLDER +r\'/FLIGHTS_NOT_DEPARTED_SQL_8.sql\'\n\nEDW_SQL_9= SQL_FOLDER +r\'/Cancelled_flights_SQL_9.sql\' ## Converted\nEDW_SQL_10= SQL_FOLDER +r\'/Yet_to_Depart_flights_SQL_10.sql\'\nEDW_SQL_11= SQL_FOLDER +r\'/Residual_cancels_SQL_11.sql\' ## Converted\nEDW_SQL_12= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_SQL_12.sql\'\n\nEDW_SQL_13= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_COUNT_SQL_13.sql\'\nEDW_SQL_14= SQL_FOLDER +r\'/Diverted_flights_SQL_14.sql\'\nEDW_SQL_15 = SQL_FOLDER + r\'/UA_Line.sql\'\nEDW_SQL_16 = SQL_FOLDER + r\'/UA_Seat_Cancels.sql\'\nEDW_SQL_17 = SQL_FOLDER + r\'/Carrier_delays.sql\'\nEDW_SQL_18= SQL_FOLDER +r\'/Delays_info.sql\'\n\n\n\nMF_SQL_1= SQL_FOLDER +r\'/OA_SQL_1.sql\'\nMF_SQL_2= SQL_FOLDER +r\'/OA_SQL_2.sql\'\nMF_SQL_3= SQL_FOLDER +r\'/OA_Line.sql\'\nMF_SQL_4= SQL_FOLDER +r\'/OA_SeatCnxl.sql\'\nUA_SQL_1_CSV_FILE = CSV_FLDR + r\'UA_SQL_1_\' +TODAY+\'.csv\'\nCNXL_SQL_2_CSV_FILE = CSV_FLDR + r\'CNXL_SQL_2_\' +TODAY+\'.csv\'\nRES_CNXL_SQL_3_CSV_FILE = CSV_FLDR + r\'RES_CNXL_SQL_3_\' +TODAY+\'.csv\'\nSCH_DEP_SQL_4_CSV_FILE = CSV_FLDR + r\'SCH_DEP_SQL_4_\' +TODAY+\'.csv\'\nDIVERTS_SQL_5_CSV_FILE = CSV_FLDR + r\'DIVERTS_SQL_5_\' +TODAY+\'.csv\'\nRECOVERED_DIVERTS_SQL_6_CSV_FILE = CSV_FLDR + r\'RECOVERED_DIVERTS_SQL_6_\' +TODAY+\'.csv\'\nUA_HUB_SQL_7_CSV_FILE = CSV_FLDR + r\'UA_HUB_SQL_7_\' +TODAY+\'.csv\'\nFLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE = CSV_FLDR + r\'FLIGHTS_NOT_DEPARTED_SQL_8_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_COUNT_SQL_13_\' +TODAY+\'.csv\'\nCancelled_flights_SQL_9_CSV_FILE = CSV_FLDR + r\'Cancelled_flights_SQL_9_\' +TODAY+\'.csv\'\nYet_to_Depart_flights_SQL_10_CSV_FILE = CSV_FLDR + r\'Yet_to_Depart_flights_SQL_10_\' +TODAY+\'.csv\'\nResidual_cancels_SQL_11_CSV_FILE = CSV_FLDR + r\'Residual_cancels_SQL_11_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_SQL_12_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_SQL_12_\' +TODAY+\'.csv\'\nDIVERTED_FLIGHTS_SQL_14_CSV_FILE = CSV_FLDR + r\'Diverted_flights_SQL_14\' +TODAY+\'.csv\'\nUA_Line_CSV_FILE = CSV_FLDR + r\'UA_Line\' +TODAY+\'.csv\'\nUA_Seat_Cancels_CSV_FILE = CSV_FLDR + r\'UA_Seat_Cancels\' +TODAY+\'.csv\'\nDELAYS_INFO_CSV_FILE = CSV_FLDR + r\'Delays_info\' +TODAY+\'.csv\'\nCarrier_delays_CSV_FILE = CSV_FLDR + r\'Carrier_delays\' +TODAY+\'.csv\'\nOA_SQL_1_CSV_FILE = CSV_FLDR + r\'OA_SQL_1_\' +TODAY+\'.csv\'\nOA_SQL_2_CSV_FILE = CSV_FLDR + r\'OA_SQL_2_\' +TODAY+\'.csv\'\nOA_Line_CSV_FILE = CSV_FLDR + r\'OA_Line_\' +TODAY+\'.csv\'\nOA_SeatCnxl_CSV_FILE = CSV_FLDR + r\'OA_SeatCnxl_\' +TODAY+\'.csv\'\nPNG_FILE_SYS1 = PNG_FLDR + TODAY + r\' pg1.png\'\nXLS_SHT_SYS1 = \'pg1\'\nPNG_FILE_SYS2 = PNG_FLDR + TODAY + r\' pg2.png\'\nXLS_SHT_SYS2 = \'pg2\'\nPDF_FILE_PATH = PDF_FLDR + YEST + r\'_745_UAX\' +\'.pdf\'\n\nlogging.basicConfig(filename=LOG_FILE_NAME, level=logging.DEBUG, format=\'%(asctime)s %(message)s\')\n\nlogging.info(\'Connecting to Teradata\');\n\n# Database credentials for UDH\nudh_username = \'app_noc_daily_ops_call\'\nudh_pass = \'SBhe09r7h20gsav\'\n\n# Connect to UDH (Redshift)\nlogging.info(\'Connecting to UDH\')\nprint(\'Connecting to UDH\')\n\ntry:\n    udh_connection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host=\'cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com\',\n        dbname=\'udhprod\',\n        port=5439\n    )\n    logging.info(\'UDH connection successful\')\nexcept Exception as e:\n    logging.error(f\'UDH connection failed: {str(e)}\')\n    raise\n\ne1 = open(EDW_SQL_1, \'r\')\nsqlEdw1 = e1.read()\ne1.close()\n\ne2 = open(EDW_SQL_2, \'r\')\nsqlEdw2 = e2.read()\ne2.close()\n\ne3 = open(EDW_SQL_3, \'r\')\nsqlEdw3 = e3.read()\ne3.close()\n\ne4 = open(EDW_SQL_4, \'r\')\nsqlEdw4 = e4.read()\ne4.close()\n\ne5 = open(EDW_SQL_5, \'r\')\nsqlEdw5 = e5.read()\ne5.close()\n\ne6 = open(EDW_SQL_6, \'r\')\nsqlEdw6 = e6.read()\ne6.close()\n\ne7 = open(EDW_SQL_7, \'r\')\nsqlEdw7 = e7.read()\ne7.close()\n\ne8 = open(EDW_SQL_8, \'r\')\nsqlEdw8 = e8.read()\ne8.close()\n\ne9 = open(EDW_SQL_9, \'r\')\nsqlEdw9 = e9.read()\ne9.close()\n\ne10 = open(EDW_SQL_10, \'r\')\nsqlEdw10 = e10.read()\ne10.close()\n\ne11 = open(EDW_SQL_11, \'r\')\nsqlEdw11 = e11.read()\ne11.close()\n\ne12 = open(EDW_SQL_12, \'r\')\nsqlEdw12 = e12.read()\ne12.close()\n\ne13 = open(EDW_SQL_13, \'r\')\nsqlEdw13 = e13.read()\ne13.close()\n\ne14 = open(EDW_SQL_14, \'r\')\nsqlEdw14 = e14.read()\ne14.close()\n\ne15 = open(EDW_SQL_15, \'r\')\nsqlEdw15 = e15.read()\ne15.close()\n\ne16 = open(EDW_SQL_16, \'r\')\nsqlEdw16 = e16.read()\ne16.close()\n\ne17 = open(EDW_SQL_17, \'r\')\nsqlEdw17 = e17.read()\ne17.close()\n\ne18 = open(EDW_SQL_18, \'r\')\nsqlEdw18 = e18.read()\ne18.close()\n\n\n'}, 'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 215}], 'id': 2}}}}}, 'buffers': []})
2025-11-14 07:29:31,618 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '67fcd8e4-28aa-4247-b8e3-43de5d498892', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 29, 31, 568000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '67fcd8e4-28aa-4247-b8e3-43de5d498892', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 215, 'commandId': 8801006436713097}], 'editedCommandId': 8801006436713097, 'contentChanges': [{'range': {'start': {'line': 214, 'character': 0}, 'end': {'line': 215, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 214, 'character': 0}, 'end': {'line': 214, 'character': 0}}, 'text': '\n'}], 'cursorPosition': {'line': 214, 'character': 0}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 2}, 'id': 3}}}}}, 'buffers': []})
2025-11-14 07:29:46,309 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '1beaf9fa-fd7e-42c8-aa99-a89c15cecaf3', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 29, 46, 256000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '1beaf9fa-fd7e-42c8-aa99-a89c15cecaf3', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}], 'editedCommandId': 8801006436713097, 'contentChanges': [{'range': {'start': {'line': 214, 'character': 0}, 'end': {'line': 215, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 214, 'character': 0}, 'end': {'line': 214, 'character': 0}}, 'text': "sqlresult_1 = pd.read_sql_query(sqlEdw1, connection)\nsqlresult_1.to_csv(UA_SQL_1_CSV_FILE, index=False)\n\nsqlresult_2 = pd.read_sql_query(sqlEdw2, connection)\nsqlresult_2.to_csv(CNXL_SQL_2_CSV_FILE, index=False)\n\nsqlresult_3 = pd.read_sql_query(sqlEdw3, connection)\nsqlresult_3.to_csv(RES_CNXL_SQL_3_CSV_FILE, index=False)\n\nsqlresult_4 = pd.read_sql_query(sqlEdw4, connection)\nsqlresult_4.to_csv(SCH_DEP_SQL_4_CSV_FILE, index=False)\n\nsqlresult_5 = pd.read_sql_query(sqlEdw5, connection)\nsqlresult_5.to_csv(DIVERTS_SQL_5_CSV_FILE, index=False)\n\nsqlresult_6 = pd.read_sql_query(sqlEdw6, connection)\nsqlresult_6.to_csv(RECOVERED_DIVERTS_SQL_6_CSV_FILE, index=False)\n\nsqlresult_7 = pd.read_sql_query(sqlEdw7, connection)\nsqlresult_7.to_csv(UA_HUB_SQL_7_CSV_FILE, index=False)\n\nsqlresult_10 = pd.read_sql_query(sqlEdw8, connection)\nsqlresult_10.to_csv(FLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE, index=False)\n\nsqlresult_11 = pd.read_sql_query(sqlEdw9, connection)\nsqlresult_11.to_csv(Cancelled_flights_SQL_9_CSV_FILE, index=False)\n\nsqlresult_12 = pd.read_sql_query(sqlEdw10, connection)\nsqlresult_12.to_csv(Yet_to_Depart_flights_SQL_10_CSV_FILE, index=False)\n\nsqlresult_13 = pd.read_sql_query(sqlEdw11, connection)\nsqlresult_13.to_csv(Residual_cancels_SQL_11_CSV_FILE, index=False)\n\nsqlresult_14 = pd.read_sql_query(sqlEdw12, connection)\nsqlresult_14.to_csv(REPOSITIONED_FLIGHTS_SQL_12_CSV_FILE, index=False)\n\nsqlresult_15 = pd.read_sql_query(sqlEdw13, connection)\nsqlresult_15.to_csv(REPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE, index=False)\n\nsqlresult_16 = pd.read_sql_query(sqlEdw14, connection)\nsqlresult_16.to_csv(DIVERTED_FLIGHTS_SQL_14_CSV_FILE, index=False)\n\nsqlresult_17 = pd.read_sql_query(sqlEdw15, connection)\nsqlresult_17.to_csv(UA_Line_CSV_FILE, index=False)\n\nsqlresult_18 = pd.read_sql_query(sqlEdw16, connection)\nsqlresult_18.to_csv(UA_Seat_Cancels_CSV_FILE, index=False)\n\nsqlresult_19 = pd.read_sql_query(sqlEdw17, connection)\nsqlresult_19.to_csv(Carrier_delays_CSV_FILE, index=False)\n\nsqlresult_20 = pd.read_sql_query(sqlEdw18, connection)\nsqlresult_20.to_csv(DELAYS_INFO_CSV_FILE, index=False)\nlogging.info('Running MF SQL queries');\n\n"}], 'cursorPosition': {'line': 268, 'character': 0}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 3}, 'id': 4}}}}}, 'buffers': []})
2025-11-14 07:29:46,435 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '9ebf312e-5b01-47b5-b056-49177e4d4c68', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 29, 46, 393000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '9ebf312e-5b01-47b5-b056-49177e4d4c68', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'method': 'textDocument/definition', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477'}, 'position': {'line': 250, 'character': 3}}, 'id': 1, 'jsonrpc': '2.0', 'cachedFilesAndMtimes': {}}}}}, 'buffers': []})
2025-11-14 07:29:49,657 Received command c on object id p0
2025-11-14 07:29:49,698 Command to send: c
o397
get
sspark.databricks.driver.ipykernel.maxErrorMessageLength
s100000
e

2025-11-14 07:29:49,699 Answer received: !ys100000
2025-11-14 07:29:49,700 Command to send: c
o397
get
sspark.databricks.driver.ipykernel.maxErrorMessageLength
s100000
e

2025-11-14 07:29:49,711 Answer received: !ys100000
2025-11-14 07:30:22,806 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'f5ba4a4d-a223-42f5-b847-3c65275ae807', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 30, 22, 753000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'f5ba4a4d-a223-42f5-b847-3c65275ae807', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}], 'editedCommandId': 8801006436713092, 'contentChanges': [{'range': {'start': {'line': 121, 'character': 0}, 'end': {'line': 141, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 121, 'character': 0}, 'end': {'line': 121, 'character': 0}}, 'text': "# Database credentials for UDH\nudh_username = 'app_noc_daily_ops_call'\nudh_pass = 'SBhe09r7h20gsav'\n\n# Connect to UDH (Redshift)\nlogging.info('Connecting to UDH')\nprint('Connecting to UDH')\n\ntry:\n    udhconnection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host='cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com',\n        dbname='udhprod',\n        port=5439\n    )\n    logging.info('UDH connection successful')\nexcept Exception as e:\n    logging.error(f'UDH connection failed: {str(e)}')\n    raise\n"}], 'cursorPosition': {'line': 130, 'character': 7}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 4}, 'id': 5}}}}}, 'buffers': []})
2025-11-14 07:30:23,231 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'cb26c27e-253a-4cc5-91df-ae086fcdce54', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 30, 23, 190000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'cb26c27e-253a-4cc5-91df-ae086fcdce54', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}], 'editedCommandId': 8801006436713092, 'contentChanges': [{'range': {'start': {'line': 121, 'character': 0}, 'end': {'line': 141, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 121, 'character': 0}, 'end': {'line': 121, 'character': 0}}, 'text': "# Database credentials for UDH\nudh_username = 'app_noc_daily_ops_call'\nudh_pass = 'SBhe09r7h20gsav'\n\n# Connect to UDH (Redshift)\nlogging.info('Connecting to UDH')\nprint('Connecting to UDH')\n\ntry:\n    udconnection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host='cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com',\n        dbname='udhprod',\n        port=5439\n    )\n    logging.info('UDH connection successful')\nexcept Exception as e:\n    logging.error(f'UDH connection failed: {str(e)}')\n    raise\n"}], 'cursorPosition': {'line': 130, 'character': 6}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 5}, 'id': 6}}}}}, 'buffers': []})
2025-11-14 07:30:23,419 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'ea43efb7-a23b-4231-8569-b80b3713f85a', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 30, 23, 382000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'ea43efb7-a23b-4231-8569-b80b3713f85a', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}], 'editedCommandId': 8801006436713092, 'contentChanges': [{'range': {'start': {'line': 121, 'character': 0}, 'end': {'line': 141, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 121, 'character': 0}, 'end': {'line': 121, 'character': 0}}, 'text': "# Database credentials for UDH\nudh_username = 'app_noc_daily_ops_call'\nudh_pass = 'SBhe09r7h20gsav'\n\n# Connect to UDH (Redshift)\nlogging.info('Connecting to UDH')\nprint('Connecting to UDH')\n\ntry:\n    uconnection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host='cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com',\n        dbname='udhprod',\n        port=5439\n    )\n    logging.info('UDH connection successful')\nexcept Exception as e:\n    logging.error(f'UDH connection failed: {str(e)}')\n    raise\n"}], 'cursorPosition': {'line': 130, 'character': 5}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 6}, 'id': 7}}}}}, 'buffers': []})
2025-11-14 07:30:23,740 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'e0482f70-a5ba-4ea7-bca8-fe0beb5a47b8', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 30, 23, 686000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'e0482f70-a5ba-4ea7-bca8-fe0beb5a47b8', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}], 'editedCommandId': 8801006436713092, 'contentChanges': [{'range': {'start': {'line': 121, 'character': 0}, 'end': {'line': 141, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 121, 'character': 0}, 'end': {'line': 121, 'character': 0}}, 'text': "# Database credentials for UDH\nudh_username = 'app_noc_daily_ops_call'\nudh_pass = 'SBhe09r7h20gsav'\n\n# Connect to UDH (Redshift)\nlogging.info('Connecting to UDH')\nprint('Connecting to UDH')\n\ntry:\n    connection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host='cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com',\n        dbname='udhprod',\n        port=5439\n    )\n    logging.info('UDH connection successful')\nexcept Exception as e:\n    logging.error(f'UDH connection failed: {str(e)}')\n    raise\n"}], 'cursorPosition': {'line': 130, 'character': 4}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 7}, 'id': 8}}}}}, 'buffers': []})
2025-11-14 07:30:24,537 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '8c17c70d-e1f2-49a8-8bb8-be0ef27ee7c7', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 30, 24, 490000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '8c17c70d-e1f2-49a8-8bb8-be0ef27ee7c7', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}], 'editedCommandId': 8801006436713092, 'contentChanges': [{'range': {'start': {'line': 121, 'character': 0}, 'end': {'line': 141, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 121, 'character': 0}, 'end': {'line': 121, 'character': 0}}, 'text': "# Database credentials for UDH\nudh_username = 'app_noc_daily_ops_call'\nudh_pass = 'SBhe09r7h20gsav'\n\n# Connect to UDH (Redshift)\nlogging.info('Connecting to UDH')\nprint('Connecting to UDH')\n\ntry:\n        connection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host='cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com',\n        dbname='udhprod',\n        port=5439\n    )\n    logging.info('UDH connection successful')\nexcept Exception as e:\n    logging.error(f'UDH connection failed: {str(e)}')\n    raise\n"}], 'cursorPosition': {'line': 130, 'character': 8}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 8}, 'id': 9}}}}}, 'buffers': []})
2025-11-14 07:30:33,123 Received command c on object id p0
2025-11-14 07:30:33,128 Command to send: c
o397
get
sspark.databricks.driver.ipykernel.maxErrorMessageLength
s100000
e

2025-11-14 07:30:33,133 Answer received: !ys100000
2025-11-14 07:30:33,135 Command to send: c
o397
get
sspark.databricks.driver.ipykernel.maxErrorMessageLength
s100000
e

2025-11-14 07:30:33,141 Answer received: !ys100000
2025-11-14 07:30:55,187 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '6a82c901-9caa-43c6-a184-ac534100b03e', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 30, 55, 138000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '6a82c901-9caa-43c6-a184-ac534100b03e', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}], 'editedCommandId': 8801006436713092, 'contentChanges': [{'range': {'start': {'line': 121, 'character': 0}, 'end': {'line': 141, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 121, 'character': 0}, 'end': {'line': 121, 'character': 0}}, 'text': "# Database credentials for UDH\nudh_username = 'app_noc_daily_ops_call'\nudh_pass = 'SBhe09r7h20gsav'\n\n# Connect to UDH (Redshift)\nlogging.info('Connecting to UDH')\nprint('Connecting to UDH')\n\ntry:\n    connection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host='cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com',\n        dbname='udhprod',\n        port=5439\n    )\n    logging.info('UDH connection successful')\nexcept Exception as e:\n    logging.error(f'UDH connection failed: {str(e)}')\n    raise\n"}], 'cursorPosition': {'line': 130, 'character': 4}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 9}, 'id': 10}}}}}, 'buffers': []})
2025-11-14 07:30:58,766 Received command c on object id p0
2025-11-14 07:30:58,771 Connecting to UDH
2025-11-14 07:30:58,812 UDH connection successful
2025-11-14 07:30:59,457 Command to send: i
java.util.HashMap
e

2025-11-14 07:30:59,459 Answer received: !yao448
2025-11-14 07:30:59,459 Command to send: c
o448
put
spackageNameRaw
sjson
e

2025-11-14 07:30:59,459 Answer received: !yn
2025-11-14 07:30:59,459 Command to send: c
o448
put
spackageNameAllowlisted
s02bd175f329720378ce83dd56a1b6b1f5291a60182d6c54b5e0d1e8d248a267a
e

2025-11-14 07:30:59,460 Answer received: !yn
2025-11-14 07:30:59,460 Command to send: c
o448
put
spackageHash
s02bd175f329720378ce83dd56a1b6b1f5291a60182d6c54b5e0d1e8d248a267a
e

2025-11-14 07:30:59,460 Answer received: !yn
2025-11-14 07:30:59,460 Command to send: c
o448
put
spackageVersion
sunknown
e

2025-11-14 07:30:59,460 Answer received: !yn
2025-11-14 07:30:59,461 Command to send: c
o416
logUsage
spythonPackageImported
ro448
n
e

2025-11-14 07:30:59,462 Answer received: !yv
2025-11-14 07:30:59,462 Command to send: i
java.util.HashMap
e

2025-11-14 07:30:59,462 Answer received: !yao449
2025-11-14 07:30:59,462 Command to send: c
o449
put
spackageNameRaw
swarnings
e

2025-11-14 07:30:59,463 Answer received: !yn
2025-11-14 07:30:59,463 Command to send: c
o449
put
spackageNameAllowlisted
s227690d7c3030c812d93d4e09295831f6e820ab866e0d851852f1b5e4c50c5d2
e

2025-11-14 07:30:59,463 Answer received: !yn
2025-11-14 07:30:59,463 Command to send: c
o449
put
spackageHash
s227690d7c3030c812d93d4e09295831f6e820ab866e0d851852f1b5e4c50c5d2
e

2025-11-14 07:30:59,463 Answer received: !yn
2025-11-14 07:30:59,464 Command to send: c
o449
put
spackageVersion
sunknown
e

2025-11-14 07:30:59,464 Answer received: !yn
2025-11-14 07:30:59,464 Command to send: c
o416
logUsage
spythonPackageImported
ro449
n
e

2025-11-14 07:30:59,465 Answer received: !yv
2025-11-14 07:30:59,465 Command to send: i
java.util.HashMap
e

2025-11-14 07:30:59,465 Answer received: !yao450
2025-11-14 07:30:59,465 Command to send: c
o450
put
spackageNameRaw
sinspect
e

2025-11-14 07:30:59,465 Answer received: !yn
2025-11-14 07:30:59,466 Command to send: c
o450
put
spackageNameAllowlisted
s14a60637758cb026afd2fe447f3648a07965072eeefaa9ee57734959bce8ae2b
e

2025-11-14 07:30:59,466 Answer received: !yn
2025-11-14 07:30:59,466 Command to send: c
o450
put
spackageHash
s14a60637758cb026afd2fe447f3648a07965072eeefaa9ee57734959bce8ae2b
e

2025-11-14 07:30:59,466 Answer received: !yn
2025-11-14 07:30:59,466 Command to send: c
o450
put
spackageVersion
sunknown
e

2025-11-14 07:30:59,466 Answer received: !yn
2025-11-14 07:30:59,467 Command to send: c
o416
logUsage
spythonPackageImported
ro450
n
e

2025-11-14 07:30:59,467 Answer received: !yv
2025-11-14 07:31:00,390 Command to send: m
d
o448
e

2025-11-14 07:31:00,391 Error while sending or receiving.
Traceback (most recent call last):
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 528, in send_command
    self.socket.sendall(command.encode("utf-8"))
ConnectionResetError: [Errno 104] Connection reset by peer
2025-11-14 07:31:00,391 Closing down clientserver connection
2025-11-14 07:31:00,391 Exception while shutting down a socket
Traceback (most recent call last):
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 528, in send_command
    self.socket.sendall(command.encode("utf-8"))
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 1038, in send_command
    response = connection.send_command(command)
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 531, in send_command
    raise Py4JNetworkError(
py4j.protocol.Py4JNetworkError: Error while sending

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 503, in quiet_shutdown
    socket_instance.shutdown(socket.SHUT_RDWR)
OSError: [Errno 107] Transport endpoint is not connected
2025-11-14 07:31:00,391 Exception while sending command.
Traceback (most recent call last):
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 528, in send_command
    self.socket.sendall(command.encode("utf-8"))
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 1038, in send_command
    response = connection.send_command(command)
  File "/databricks/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 531, in send_command
    raise Py4JNetworkError(
py4j.protocol.Py4JNetworkError: Error while sending
2025-11-14 07:31:00,392 Command to send: A
1e5d8e39e11ea7b92ba7095e3af7a4c598aba5612781472207af95c4223e9e25

2025-11-14 07:31:00,393 Answer received: !yv
2025-11-14 07:31:00,393 Command to send: m
d
o448
e

2025-11-14 07:31:00,394 Answer received: !yv
2025-11-14 07:31:00,394 Closing down clientserver connection
2025-11-14 07:31:00,394 Command to send: m
d
o449
e

2025-11-14 07:31:00,394 Answer received: !yv
2025-11-14 07:31:00,394 Command to send: m
d
o450
e

2025-11-14 07:31:00,394 Answer received: !yv
2025-11-14 07:31:05,336 Received command c on object id p0
2025-11-14 07:31:10,861 Received command c on object id p0
2025-11-14 07:32:02,136 Running MF SQL queries
2025-11-14 07:32:26,622 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '89aed6f7-004a-4b51-b3c8-d58ff4003a81', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 32, 26, 570000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '89aed6f7-004a-4b51-b3c8-d58ff4003a81', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didOpen', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'languageId': 'python', 'version': 1, 'text': 'from databricks.sdk.runtime import display, displayHTML, getArgument, sc, spark, sql, sqlContext, table, udf;from dbruntime.dbutils import DBUtils as dbutils;from IPython import get_ipython;In={};Out={};_ih=[];_oh={};_dh=[];_=None;__=None;___=None;_i=None;_ii=None;_sqldf=spark.createDataFrame([], schema=[])\n# %pip install "sqlalchemy<2.0"\ndbutils.library.restartPython()\n\nmode = \'PROD\'\n\n\n\nimport pandas as pd\nimport datetime\nimport logging\nimport os\nimport pyodbc\nimport smtplib as smtp\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.text import MIMEText\n\nfrom email.utils import formataddr\nfrom email.header import Header\nfrom email import encoders\nfrom email.mime.base import MIMEBase\nfrom email.mime.application import MIMEApplication\nfrom email.mime.image import MIMEImage\nimport urllib.parse\nfrom sqlalchemy import create_engine, text\nimport re\nfrom random import *\nimport psycopg2\nos.chdir(r\'/Workspace/Ops Analysis/Reports/745 express weekly\')\nTODAY = datetime.datetime.today().strftime(\'%Y%m%d\')\nYES = datetime.date.today() - datetime.timedelta(days=1)\nLW = datetime.date.today() - datetime.timedelta(days=7)\nYESTERDAY = YES.strftime(\'%m/%d/%Y\')\nLWDATE = LW.strftime(\'%m/%d/%Y\')\nYEST = YES.strftime(\'%Y-%m-%d\')\n\nif mode == \'PROD\':\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr.csv\'\nelse:\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr_test.csv\'\n    \nLOG_FILE_NAME = os.getcwd() + r\'/logs/\' + datetime.datetime.today().strftime(\'%Y%m%d %H%M%S\') + \'.log\'\nCSV_FLDR = os.getcwd() + r\'/CSV/\'\nSQL_FOLDER = os.getcwd() + r\'/SQL\'\nXLSX_FLDR = os.getcwd() + r\'/XLSX/\'\nHTML_FLDR = os.getcwd() + r\'/HTML/\'\nPNG_FLDR = os.getcwd() + r\'/DailyImages/\'\nfilename_attach = os.getcwd() + r\'/0745_UAX_WB_Flights.xlsm\'\nPDF_FLDR = os.getcwd() + r\'/PDF/\'\nfilename = os.getcwd() + r\'/0745_UAX_WB_final_v1.xlsm\'\n\nCID1 =  \'1\'\nCID2 =  \'2\'\n\n\nHTML_BDY_FILE_PATH = HTML_FLDR + r\'EmailBody.htm\'\nHTML_FTR_FILE_PATH = HTML_FLDR + r\'EmailFooter.htm\'\n\nXLS_FILE_PATH = XLSX_FLDR + YEST + r\' 0745 UAX Flight details.xlsm\'\n\nXLS_FILE_NAME = YEST + r\' 0745 Weekly UAX Flight details.xlsm\'\n\nEDW_SQL_1= SQL_FOLDER + r\'/UA_SQL_1.sql\'\nEDW_SQL_2= SQL_FOLDER +r\'/CNXL_SQL_2.sql\'\nEDW_SQL_3= SQL_FOLDER +r\'/RES_CNXL_SQL_3.sql\'\nEDW_SQL_4= SQL_FOLDER +r\'/SCH_DEP_SQL_4.sql\'\nEDW_SQL_5= SQL_FOLDER +r\'/DIVERTS_SQL_5.sql\'\nEDW_SQL_6= SQL_FOLDER +r\'/RECOVERED_DIVERTS_SQL_6.sql\'\nEDW_SQL_7= SQL_FOLDER +r\'/UA_HUB_SQL_7.sql\'\nEDW_SQL_8= SQL_FOLDER +r\'/FLIGHTS_NOT_DEPARTED_SQL_8.sql\'\n\nEDW_SQL_9= SQL_FOLDER +r\'/Cancelled_flights_SQL_9.sql\' ## Converted\nEDW_SQL_10= SQL_FOLDER +r\'/Yet_to_Depart_flights_SQL_10.sql\'\nEDW_SQL_11= SQL_FOLDER +r\'/Residual_cancels_SQL_11.sql\' ## Converted\nEDW_SQL_12= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_SQL_12.sql\'\n\nEDW_SQL_13= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_COUNT_SQL_13.sql\'\nEDW_SQL_14= SQL_FOLDER +r\'/Diverted_flights_SQL_14.sql\'\nEDW_SQL_15 = SQL_FOLDER + r\'/UA_Line.sql\'\nEDW_SQL_16 = SQL_FOLDER + r\'/UA_Seat_Cancels.sql\'\nEDW_SQL_17 = SQL_FOLDER + r\'/Carrier_delays.sql\'\nEDW_SQL_18= SQL_FOLDER +r\'/Delays_info.sql\'\n\n\n\nMF_SQL_1= SQL_FOLDER +r\'/OA_SQL_1.sql\'\nMF_SQL_2= SQL_FOLDER +r\'/OA_SQL_2.sql\'\nMF_SQL_3= SQL_FOLDER +r\'/OA_Line.sql\'\nMF_SQL_4= SQL_FOLDER +r\'/OA_SeatCnxl.sql\'\nUA_SQL_1_CSV_FILE = CSV_FLDR + r\'UA_SQL_1_\' +TODAY+\'.csv\'\nCNXL_SQL_2_CSV_FILE = CSV_FLDR + r\'CNXL_SQL_2_\' +TODAY+\'.csv\'\nRES_CNXL_SQL_3_CSV_FILE = CSV_FLDR + r\'RES_CNXL_SQL_3_\' +TODAY+\'.csv\'\nSCH_DEP_SQL_4_CSV_FILE = CSV_FLDR + r\'SCH_DEP_SQL_4_\' +TODAY+\'.csv\'\nDIVERTS_SQL_5_CSV_FILE = CSV_FLDR + r\'DIVERTS_SQL_5_\' +TODAY+\'.csv\'\nRECOVERED_DIVERTS_SQL_6_CSV_FILE = CSV_FLDR + r\'RECOVERED_DIVERTS_SQL_6_\' +TODAY+\'.csv\'\nUA_HUB_SQL_7_CSV_FILE = CSV_FLDR + r\'UA_HUB_SQL_7_\' +TODAY+\'.csv\'\nFLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE = CSV_FLDR + r\'FLIGHTS_NOT_DEPARTED_SQL_8_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_COUNT_SQL_13_\' +TODAY+\'.csv\'\nCancelled_flights_SQL_9_CSV_FILE = CSV_FLDR + r\'Cancelled_flights_SQL_9_\' +TODAY+\'.csv\'\nYet_to_Depart_flights_SQL_10_CSV_FILE = CSV_FLDR + r\'Yet_to_Depart_flights_SQL_10_\' +TODAY+\'.csv\'\nResidual_cancels_SQL_11_CSV_FILE = CSV_FLDR + r\'Residual_cancels_SQL_11_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_SQL_12_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_SQL_12_\' +TODAY+\'.csv\'\nDIVERTED_FLIGHTS_SQL_14_CSV_FILE = CSV_FLDR + r\'Diverted_flights_SQL_14\' +TODAY+\'.csv\'\nUA_Line_CSV_FILE = CSV_FLDR + r\'UA_Line\' +TODAY+\'.csv\'\nUA_Seat_Cancels_CSV_FILE = CSV_FLDR + r\'UA_Seat_Cancels\' +TODAY+\'.csv\'\nDELAYS_INFO_CSV_FILE = CSV_FLDR + r\'Delays_info\' +TODAY+\'.csv\'\nCarrier_delays_CSV_FILE = CSV_FLDR + r\'Carrier_delays\' +TODAY+\'.csv\'\nOA_SQL_1_CSV_FILE = CSV_FLDR + r\'OA_SQL_1_\' +TODAY+\'.csv\'\nOA_SQL_2_CSV_FILE = CSV_FLDR + r\'OA_SQL_2_\' +TODAY+\'.csv\'\nOA_Line_CSV_FILE = CSV_FLDR + r\'OA_Line_\' +TODAY+\'.csv\'\nOA_SeatCnxl_CSV_FILE = CSV_FLDR + r\'OA_SeatCnxl_\' +TODAY+\'.csv\'\nPNG_FILE_SYS1 = PNG_FLDR + TODAY + r\' pg1.png\'\nXLS_SHT_SYS1 = \'pg1\'\nPNG_FILE_SYS2 = PNG_FLDR + TODAY + r\' pg2.png\'\nXLS_SHT_SYS2 = \'pg2\'\nPDF_FILE_PATH = PDF_FLDR + YEST + r\'_745_UAX\' +\'.pdf\'\n\nlogging.basicConfig(filename=LOG_FILE_NAME, level=logging.DEBUG, format=\'%(asctime)s %(message)s\')\n\nlogging.info(\'Connecting to Teradata\');\n\n# Database credentials for UDH\nudh_username = \'app_noc_daily_ops_call\'\nudh_pass = \'SBhe09r7h20gsav\'\n\n# Connect to UDH (Redshift)\nlogging.info(\'Connecting to UDH\')\nprint(\'Connecting to UDH\')\n\ntry:\n    connection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host=\'cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com\',\n        dbname=\'udhprod\',\n        port=5439\n    )\n    logging.info(\'UDH connection successful\')\nexcept Exception as e:\n    logging.error(f\'UDH connection failed: {str(e)}\')\n    raise\n\ne1 = open(EDW_SQL_1, \'r\')\nsqlEdw1 = e1.read()\ne1.close()\n\ne2 = open(EDW_SQL_2, \'r\')\nsqlEdw2 = e2.read()\ne2.close()\n\ne3 = open(EDW_SQL_3, \'r\')\nsqlEdw3 = e3.read()\ne3.close()\n\ne4 = open(EDW_SQL_4, \'r\')\nsqlEdw4 = e4.read()\ne4.close()\n\ne5 = open(EDW_SQL_5, \'r\')\nsqlEdw5 = e5.read()\ne5.close()\n\ne6 = open(EDW_SQL_6, \'r\')\nsqlEdw6 = e6.read()\ne6.close()\n\ne7 = open(EDW_SQL_7, \'r\')\nsqlEdw7 = e7.read()\ne7.close()\n\ne8 = open(EDW_SQL_8, \'r\')\nsqlEdw8 = e8.read()\ne8.close()\n\ne9 = open(EDW_SQL_9, \'r\')\nsqlEdw9 = e9.read()\ne9.close()\n\ne10 = open(EDW_SQL_10, \'r\')\nsqlEdw10 = e10.read()\ne10.close()\n\ne11 = open(EDW_SQL_11, \'r\')\nsqlEdw11 = e11.read()\ne11.close()\n\ne12 = open(EDW_SQL_12, \'r\')\nsqlEdw12 = e12.read()\ne12.close()\n\ne13 = open(EDW_SQL_13, \'r\')\nsqlEdw13 = e13.read()\ne13.close()\n\ne14 = open(EDW_SQL_14, \'r\')\nsqlEdw14 = e14.read()\ne14.close()\n\ne15 = open(EDW_SQL_15, \'r\')\nsqlEdw15 = e15.read()\ne15.close()\n\ne16 = open(EDW_SQL_16, \'r\')\nsqlEdw16 = e16.read()\ne16.close()\n\ne17 = open(EDW_SQL_17, \'r\')\nsqlEdw17 = e17.read()\ne17.close()\n\ne18 = open(EDW_SQL_18, \'r\')\nsqlEdw18 = e18.read()\ne18.close()\n\nsqlresult_1 = pd.read_sql_query(sqlEdw1, connection)\nsqlresult_1.to_csv(UA_SQL_1_CSV_FILE, index=False)\n\nsqlresult_2 = pd.read_sql_query(sqlEdw2, connection)\nsqlresult_2.to_csv(CNXL_SQL_2_CSV_FILE, index=False)\n\nsqlresult_3 = pd.read_sql_query(sqlEdw3, connection)\nsqlresult_3.to_csv(RES_CNXL_SQL_3_CSV_FILE, index=False)\n\nsqlresult_4 = pd.read_sql_query(sqlEdw4, connection)\nsqlresult_4.to_csv(SCH_DEP_SQL_4_CSV_FILE, index=False)\n\nsqlresult_5 = pd.read_sql_query(sqlEdw5, connection)\nsqlresult_5.to_csv(DIVERTS_SQL_5_CSV_FILE, index=False)\n\nsqlresult_6 = pd.read_sql_query(sqlEdw6, connection)\nsqlresult_6.to_csv(RECOVERED_DIVERTS_SQL_6_CSV_FILE, index=False)\n\nsqlresult_7 = pd.read_sql_query(sqlEdw7, connection)\nsqlresult_7.to_csv(UA_HUB_SQL_7_CSV_FILE, index=False)\n\nsqlresult_10 = pd.read_sql_query(sqlEdw8, connection)\nsqlresult_10.to_csv(FLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE, index=False)\n\nsqlresult_11 = pd.read_sql_query(sqlEdw9, connection)\nsqlresult_11.to_csv(Cancelled_flights_SQL_9_CSV_FILE, index=False)\n\nsqlresult_12 = pd.read_sql_query(sqlEdw10, connection)\nsqlresult_12.to_csv(Yet_to_Depart_flights_SQL_10_CSV_FILE, index=False)\n\nsqlresult_13 = pd.read_sql_query(sqlEdw11, connection)\nsqlresult_13.to_csv(Residual_cancels_SQL_11_CSV_FILE, index=False)\n\nsqlresult_14 = pd.read_sql_query(sqlEdw12, connection)\nsqlresult_14.to_csv(REPOSITIONED_FLIGHTS_SQL_12_CSV_FILE, index=False)\n\nsqlresult_15 = pd.read_sql_query(sqlEdw13, connection)\nsqlresult_15.to_csv(REPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE, index=False)\n\nsqlresult_16 = pd.read_sql_query(sqlEdw14, connection)\nsqlresult_16.to_csv(DIVERTED_FLIGHTS_SQL_14_CSV_FILE, index=False)\n\nsqlresult_17 = pd.read_sql_query(sqlEdw15, connection)\nsqlresult_17.to_csv(UA_Line_CSV_FILE, index=False)\n\nsqlresult_18 = pd.read_sql_query(sqlEdw16, connection)\nsqlresult_18.to_csv(UA_Seat_Cancels_CSV_FILE, index=False)\n\nsqlresult_19 = pd.read_sql_query(sqlEdw17, connection)\nsqlresult_19.to_csv(Carrier_delays_CSV_FILE, index=False)\n\nsqlresult_20 = pd.read_sql_query(sqlEdw18, connection)\nsqlresult_20.to_csv(DELAYS_INFO_CSV_FILE, index=False)\nlogging.info(\'Running MF SQL queries\');\n\n\n'}, 'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}, {'startLine': 269, 'stopLine': 270}], 'id': 11}}}}}, 'buffers': []})
2025-11-14 07:32:27,564 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'acb52979-e268-48dd-b948-2cc1a02b6a2b', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 32, 27, 507000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'acb52979-e268-48dd-b948-2cc1a02b6a2b', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}, {'startLine': 269, 'stopLine': 270, 'commandId': 8801006436713105}], 'editedCommandId': 8801006436713105, 'contentChanges': [{'range': {'start': {'line': 269, 'character': 0}, 'end': {'line': 270, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 269, 'character': 0}, 'end': {'line': 269, 'character': 0}}, 'text': '\n'}], 'cursorPosition': {'line': 269, 'character': 0}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 2}, 'id': 12}}}}}, 'buffers': []})
2025-11-14 07:32:27,900 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'ad75bcf8-437f-40d5-a14c-f6571faa3980', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 32, 27, 854000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'ad75bcf8-437f-40d5-a14c-f6571faa3980', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didOpen', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'text': 'from databricks.sdk.runtime import display, displayHTML, getArgument, sc, spark, sql, sqlContext, table, udf;from dbruntime.dbutils import DBUtils as dbutils;from IPython import get_ipython;In={};Out={};_ih=[];_oh={};_dh=[];_=None;__=None;___=None;_i=None;_ii=None;_sqldf=spark.createDataFrame([], schema=[])\n# %pip install "sqlalchemy<2.0"\ndbutils.library.restartPython()\n\nmode = \'PROD\'\n\n\n\nimport pandas as pd\nimport datetime\nimport logging\nimport os\nimport pyodbc\nimport smtplib as smtp\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.text import MIMEText\n\nfrom email.utils import formataddr\nfrom email.header import Header\nfrom email import encoders\nfrom email.mime.base import MIMEBase\nfrom email.mime.application import MIMEApplication\nfrom email.mime.image import MIMEImage\nimport urllib.parse\nfrom sqlalchemy import create_engine, text\nimport re\nfrom random import *\nimport psycopg2\nos.chdir(r\'/Workspace/Ops Analysis/Reports/745 express weekly\')\nTODAY = datetime.datetime.today().strftime(\'%Y%m%d\')\nYES = datetime.date.today() - datetime.timedelta(days=1)\nLW = datetime.date.today() - datetime.timedelta(days=7)\nYESTERDAY = YES.strftime(\'%m/%d/%Y\')\nLWDATE = LW.strftime(\'%m/%d/%Y\')\nYEST = YES.strftime(\'%Y-%m-%d\')\n\nif mode == \'PROD\':\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr.csv\'\nelse:\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr_test.csv\'\n    \nLOG_FILE_NAME = os.getcwd() + r\'/logs/\' + datetime.datetime.today().strftime(\'%Y%m%d %H%M%S\') + \'.log\'\nCSV_FLDR = os.getcwd() + r\'/CSV/\'\nSQL_FOLDER = os.getcwd() + r\'/SQL\'\nXLSX_FLDR = os.getcwd() + r\'/XLSX/\'\nHTML_FLDR = os.getcwd() + r\'/HTML/\'\nPNG_FLDR = os.getcwd() + r\'/DailyImages/\'\nfilename_attach = os.getcwd() + r\'/0745_UAX_WB_Flights.xlsm\'\nPDF_FLDR = os.getcwd() + r\'/PDF/\'\nfilename = os.getcwd() + r\'/0745_UAX_WB_final_v1.xlsm\'\n\nCID1 =  \'1\'\nCID2 =  \'2\'\n\n\nHTML_BDY_FILE_PATH = HTML_FLDR + r\'EmailBody.htm\'\nHTML_FTR_FILE_PATH = HTML_FLDR + r\'EmailFooter.htm\'\n\nXLS_FILE_PATH = XLSX_FLDR + YEST + r\' 0745 UAX Flight details.xlsm\'\n\nXLS_FILE_NAME = YEST + r\' 0745 Weekly UAX Flight details.xlsm\'\n\nEDW_SQL_1= SQL_FOLDER + r\'/UA_SQL_1.sql\'\nEDW_SQL_2= SQL_FOLDER +r\'/CNXL_SQL_2.sql\'\nEDW_SQL_3= SQL_FOLDER +r\'/RES_CNXL_SQL_3.sql\'\nEDW_SQL_4= SQL_FOLDER +r\'/SCH_DEP_SQL_4.sql\'\nEDW_SQL_5= SQL_FOLDER +r\'/DIVERTS_SQL_5.sql\'\nEDW_SQL_6= SQL_FOLDER +r\'/RECOVERED_DIVERTS_SQL_6.sql\'\nEDW_SQL_7= SQL_FOLDER +r\'/UA_HUB_SQL_7.sql\'\nEDW_SQL_8= SQL_FOLDER +r\'/FLIGHTS_NOT_DEPARTED_SQL_8.sql\'\n\nEDW_SQL_9= SQL_FOLDER +r\'/Cancelled_flights_SQL_9.sql\' ## Converted\nEDW_SQL_10= SQL_FOLDER +r\'/Yet_to_Depart_flights_SQL_10.sql\'\nEDW_SQL_11= SQL_FOLDER +r\'/Residual_cancels_SQL_11.sql\' ## Converted\nEDW_SQL_12= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_SQL_12.sql\'\n\nEDW_SQL_13= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_COUNT_SQL_13.sql\'\nEDW_SQL_14= SQL_FOLDER +r\'/Diverted_flights_SQL_14.sql\'\nEDW_SQL_15 = SQL_FOLDER + r\'/UA_Line.sql\'\nEDW_SQL_16 = SQL_FOLDER + r\'/UA_Seat_Cancels.sql\'\nEDW_SQL_17 = SQL_FOLDER + r\'/Carrier_delays.sql\'\nEDW_SQL_18= SQL_FOLDER +r\'/Delays_info.sql\'\n\n\n\nMF_SQL_1= SQL_FOLDER +r\'/OA_SQL_1.sql\'\nMF_SQL_2= SQL_FOLDER +r\'/OA_SQL_2.sql\'\nMF_SQL_3= SQL_FOLDER +r\'/OA_Line.sql\'\nMF_SQL_4= SQL_FOLDER +r\'/OA_SeatCnxl.sql\'\nUA_SQL_1_CSV_FILE = CSV_FLDR + r\'UA_SQL_1_\' +TODAY+\'.csv\'\nCNXL_SQL_2_CSV_FILE = CSV_FLDR + r\'CNXL_SQL_2_\' +TODAY+\'.csv\'\nRES_CNXL_SQL_3_CSV_FILE = CSV_FLDR + r\'RES_CNXL_SQL_3_\' +TODAY+\'.csv\'\nSCH_DEP_SQL_4_CSV_FILE = CSV_FLDR + r\'SCH_DEP_SQL_4_\' +TODAY+\'.csv\'\nDIVERTS_SQL_5_CSV_FILE = CSV_FLDR + r\'DIVERTS_SQL_5_\' +TODAY+\'.csv\'\nRECOVERED_DIVERTS_SQL_6_CSV_FILE = CSV_FLDR + r\'RECOVERED_DIVERTS_SQL_6_\' +TODAY+\'.csv\'\nUA_HUB_SQL_7_CSV_FILE = CSV_FLDR + r\'UA_HUB_SQL_7_\' +TODAY+\'.csv\'\nFLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE = CSV_FLDR + r\'FLIGHTS_NOT_DEPARTED_SQL_8_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_COUNT_SQL_13_\' +TODAY+\'.csv\'\nCancelled_flights_SQL_9_CSV_FILE = CSV_FLDR + r\'Cancelled_flights_SQL_9_\' +TODAY+\'.csv\'\nYet_to_Depart_flights_SQL_10_CSV_FILE = CSV_FLDR + r\'Yet_to_Depart_flights_SQL_10_\' +TODAY+\'.csv\'\nResidual_cancels_SQL_11_CSV_FILE = CSV_FLDR + r\'Residual_cancels_SQL_11_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_SQL_12_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_SQL_12_\' +TODAY+\'.csv\'\nDIVERTED_FLIGHTS_SQL_14_CSV_FILE = CSV_FLDR + r\'Diverted_flights_SQL_14\' +TODAY+\'.csv\'\nUA_Line_CSV_FILE = CSV_FLDR + r\'UA_Line\' +TODAY+\'.csv\'\nUA_Seat_Cancels_CSV_FILE = CSV_FLDR + r\'UA_Seat_Cancels\' +TODAY+\'.csv\'\nDELAYS_INFO_CSV_FILE = CSV_FLDR + r\'Delays_info\' +TODAY+\'.csv\'\nCarrier_delays_CSV_FILE = CSV_FLDR + r\'Carrier_delays\' +TODAY+\'.csv\'\nOA_SQL_1_CSV_FILE = CSV_FLDR + r\'OA_SQL_1_\' +TODAY+\'.csv\'\nOA_SQL_2_CSV_FILE = CSV_FLDR + r\'OA_SQL_2_\' +TODAY+\'.csv\'\nOA_Line_CSV_FILE = CSV_FLDR + r\'OA_Line_\' +TODAY+\'.csv\'\nOA_SeatCnxl_CSV_FILE = CSV_FLDR + r\'OA_SeatCnxl_\' +TODAY+\'.csv\'\nPNG_FILE_SYS1 = PNG_FLDR + TODAY + r\' pg1.png\'\nXLS_SHT_SYS1 = \'pg1\'\nPNG_FILE_SYS2 = PNG_FLDR + TODAY + r\' pg2.png\'\nXLS_SHT_SYS2 = \'pg2\'\nPDF_FILE_PATH = PDF_FLDR + YEST + r\'_745_UAX\' +\'.pdf\'\n\nlogging.basicConfig(filename=LOG_FILE_NAME, level=logging.DEBUG, format=\'%(asctime)s %(message)s\')\n\nlogging.info(\'Connecting to Teradata\');\n\n# Database credentials for UDH\nudh_username = \'app_noc_daily_ops_call\'\nudh_pass = \'SBhe09r7h20gsav\'\n\n# Connect to UDH (Redshift)\nlogging.info(\'Connecting to UDH\')\nprint(\'Connecting to UDH\')\n\ntry:\n    connection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host=\'cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com\',\n        dbname=\'udhprod\',\n        port=5439\n    )\n    logging.info(\'UDH connection successful\')\nexcept Exception as e:\n    logging.error(f\'UDH connection failed: {str(e)}\')\n    raise\n\ne1 = open(EDW_SQL_1, \'r\')\nsqlEdw1 = e1.read()\ne1.close()\n\ne2 = open(EDW_SQL_2, \'r\')\nsqlEdw2 = e2.read()\ne2.close()\n\ne3 = open(EDW_SQL_3, \'r\')\nsqlEdw3 = e3.read()\ne3.close()\n\ne4 = open(EDW_SQL_4, \'r\')\nsqlEdw4 = e4.read()\ne4.close()\n\ne5 = open(EDW_SQL_5, \'r\')\nsqlEdw5 = e5.read()\ne5.close()\n\ne6 = open(EDW_SQL_6, \'r\')\nsqlEdw6 = e6.read()\ne6.close()\n\ne7 = open(EDW_SQL_7, \'r\')\nsqlEdw7 = e7.read()\ne7.close()\n\ne8 = open(EDW_SQL_8, \'r\')\nsqlEdw8 = e8.read()\ne8.close()\n\ne9 = open(EDW_SQL_9, \'r\')\nsqlEdw9 = e9.read()\ne9.close()\n\ne10 = open(EDW_SQL_10, \'r\')\nsqlEdw10 = e10.read()\ne10.close()\n\ne11 = open(EDW_SQL_11, \'r\')\nsqlEdw11 = e11.read()\ne11.close()\n\ne12 = open(EDW_SQL_12, \'r\')\nsqlEdw12 = e12.read()\ne12.close()\n\ne13 = open(EDW_SQL_13, \'r\')\nsqlEdw13 = e13.read()\ne13.close()\n\ne14 = open(EDW_SQL_14, \'r\')\nsqlEdw14 = e14.read()\ne14.close()\n\ne15 = open(EDW_SQL_15, \'r\')\nsqlEdw15 = e15.read()\ne15.close()\n\ne16 = open(EDW_SQL_16, \'r\')\nsqlEdw16 = e16.read()\ne16.close()\n\ne17 = open(EDW_SQL_17, \'r\')\nsqlEdw17 = e17.read()\ne17.close()\n\ne18 = open(EDW_SQL_18, \'r\')\nsqlEdw18 = e18.read()\ne18.close()\n\nsqlresult_1 = pd.read_sql_query(sqlEdw1, connection)\nsqlresult_1.to_csv(UA_SQL_1_CSV_FILE, index=False)\n\nsqlresult_2 = pd.read_sql_query(sqlEdw2, connection)\nsqlresult_2.to_csv(CNXL_SQL_2_CSV_FILE, index=False)\n\nsqlresult_3 = pd.read_sql_query(sqlEdw3, connection)\nsqlresult_3.to_csv(RES_CNXL_SQL_3_CSV_FILE, index=False)\n\nsqlresult_4 = pd.read_sql_query(sqlEdw4, connection)\nsqlresult_4.to_csv(SCH_DEP_SQL_4_CSV_FILE, index=False)\n\nsqlresult_5 = pd.read_sql_query(sqlEdw5, connection)\nsqlresult_5.to_csv(DIVERTS_SQL_5_CSV_FILE, index=False)\n\nsqlresult_6 = pd.read_sql_query(sqlEdw6, connection)\nsqlresult_6.to_csv(RECOVERED_DIVERTS_SQL_6_CSV_FILE, index=False)\n\nsqlresult_7 = pd.read_sql_query(sqlEdw7, connection)\nsqlresult_7.to_csv(UA_HUB_SQL_7_CSV_FILE, index=False)\n\nsqlresult_10 = pd.read_sql_query(sqlEdw8, connection)\nsqlresult_10.to_csv(FLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE, index=False)\n\nsqlresult_11 = pd.read_sql_query(sqlEdw9, connection)\nsqlresult_11.to_csv(Cancelled_flights_SQL_9_CSV_FILE, index=False)\n\nsqlresult_12 = pd.read_sql_query(sqlEdw10, connection)\nsqlresult_12.to_csv(Yet_to_Depart_flights_SQL_10_CSV_FILE, index=False)\n\nsqlresult_13 = pd.read_sql_query(sqlEdw11, connection)\nsqlresult_13.to_csv(Residual_cancels_SQL_11_CSV_FILE, index=False)\n\nsqlresult_14 = pd.read_sql_query(sqlEdw12, connection)\nsqlresult_14.to_csv(REPOSITIONED_FLIGHTS_SQL_12_CSV_FILE, index=False)\n\nsqlresult_15 = pd.read_sql_query(sqlEdw13, connection)\nsqlresult_15.to_csv(REPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE, index=False)\n\nsqlresult_16 = pd.read_sql_query(sqlEdw14, connection)\nsqlresult_16.to_csv(DIVERTED_FLIGHTS_SQL_14_CSV_FILE, index=False)\n\nsqlresult_17 = pd.read_sql_query(sqlEdw15, connection)\nsqlresult_17.to_csv(UA_Line_CSV_FILE, index=False)\n\nsqlresult_18 = pd.read_sql_query(sqlEdw16, connection)\nsqlresult_18.to_csv(UA_Seat_Cancels_CSV_FILE, index=False)\n\nsqlresult_19 = pd.read_sql_query(sqlEdw17, connection)\nsqlresult_19.to_csv(Carrier_delays_CSV_FILE, index=False)\n\nsqlresult_20 = pd.read_sql_query(sqlEdw18, connection)\nsqlresult_20.to_csv(DELAYS_INFO_CSV_FILE, index=False)\nlogging.info(\'Running MF SQL queries\');\n\n\n'}, 'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}, {'startLine': 269, 'stopLine': 270, 'commandId': 8801006436713105}], 'id': 13}}}}}, 'buffers': []})
2025-11-14 07:32:45,970 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '1998c9a1-a2fe-426d-90da-58b3264bebf6', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 32, 45, 911000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '1998c9a1-a2fe-426d-90da-58b3264bebf6', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}, {'startLine': 269, 'stopLine': 288, 'commandId': 8801006436713105}], 'editedCommandId': 8801006436713105, 'contentChanges': [{'range': {'start': {'line': 269, 'character': 0}, 'end': {'line': 270, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 269, 'character': 0}, 'end': {'line': 269, 'character': 0}}, 'text': 'masflight_connection_string = "mysql+pymysql://ua_sumit_sharma1:uukexRCsHyAb9kw6rcMX@54.163.228.37:3306/masflightdb_customers_prd?charset=utf8mb4"\nlogging.info(\'Connecting to Masflight\')\n\nm1 = open(MF_SQL_1, \'r\')\nsqlMf1 = text(m1.read())\nm1.close()\n\nm2 = open(MF_SQL_2, \'r\')\nsqlMf2 = text(m2.read())\nm2.close()\n\nm3 = open(MF_SQL_3, \'r\')\nsqlMf3 = text(m3.read())\nm3.close()\n\nm4 = open(MF_SQL_4, \'r\')\nsqlMf4 = text(m4.read())\nm4.close()\n\n'}], 'cursorPosition': {'line': 287, 'character': 0}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 3}, 'id': 14}}}}}, 'buffers': []})
2025-11-14 07:32:46,067 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'a7a7f9f6-afe6-4426-86db-316e6fb8d9ae', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 32, 46, 26000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'a7a7f9f6-afe6-4426-86db-316e6fb8d9ae', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'method': 'textDocument/definition', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477'}, 'position': {'line': 278, 'character': 7}}, 'id': 2, 'jsonrpc': '2.0', 'cachedFilesAndMtimes': {}}}}}, 'buffers': []})
2025-11-14 07:32:47,551 Received command c on object id p0
2025-11-14 07:32:47,557 Connecting to Masflight
2025-11-14 07:32:51,247 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '3f1b27a0-3a48-41f5-b61b-8bafa4670005', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 32, 51, 189000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '3f1b27a0-3a48-41f5-b61b-8bafa4670005', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didOpen', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'languageId': 'python', 'version': 1, 'text': 'from databricks.sdk.runtime import display, displayHTML, getArgument, sc, spark, sql, sqlContext, table, udf;from dbruntime.dbutils import DBUtils as dbutils;from IPython import get_ipython;In={};Out={};_ih=[];_oh={};_dh=[];_=None;__=None;___=None;_i=None;_ii=None;_sqldf=spark.createDataFrame([], schema=[])\n# %pip install "sqlalchemy<2.0"\ndbutils.library.restartPython()\n\nmode = \'PROD\'\n\n\n\nimport pandas as pd\nimport datetime\nimport logging\nimport os\nimport pyodbc\nimport smtplib as smtp\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.text import MIMEText\n\nfrom email.utils import formataddr\nfrom email.header import Header\nfrom email import encoders\nfrom email.mime.base import MIMEBase\nfrom email.mime.application import MIMEApplication\nfrom email.mime.image import MIMEImage\nimport urllib.parse\nfrom sqlalchemy import create_engine, text\nimport re\nfrom random import *\nimport psycopg2\nos.chdir(r\'/Workspace/Ops Analysis/Reports/745 express weekly\')\nTODAY = datetime.datetime.today().strftime(\'%Y%m%d\')\nYES = datetime.date.today() - datetime.timedelta(days=1)\nLW = datetime.date.today() - datetime.timedelta(days=7)\nYESTERDAY = YES.strftime(\'%m/%d/%Y\')\nLWDATE = LW.strftime(\'%m/%d/%Y\')\nYEST = YES.strftime(\'%Y-%m-%d\')\n\nif mode == \'PROD\':\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr.csv\'\nelse:\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr_test.csv\'\n    \nLOG_FILE_NAME = os.getcwd() + r\'/logs/\' + datetime.datetime.today().strftime(\'%Y%m%d %H%M%S\') + \'.log\'\nCSV_FLDR = os.getcwd() + r\'/CSV/\'\nSQL_FOLDER = os.getcwd() + r\'/SQL\'\nXLSX_FLDR = os.getcwd() + r\'/XLSX/\'\nHTML_FLDR = os.getcwd() + r\'/HTML/\'\nPNG_FLDR = os.getcwd() + r\'/DailyImages/\'\nfilename_attach = os.getcwd() + r\'/0745_UAX_WB_Flights.xlsm\'\nPDF_FLDR = os.getcwd() + r\'/PDF/\'\nfilename = os.getcwd() + r\'/0745_UAX_WB_final_v1.xlsm\'\n\nCID1 =  \'1\'\nCID2 =  \'2\'\n\n\nHTML_BDY_FILE_PATH = HTML_FLDR + r\'EmailBody.htm\'\nHTML_FTR_FILE_PATH = HTML_FLDR + r\'EmailFooter.htm\'\n\nXLS_FILE_PATH = XLSX_FLDR + YEST + r\' 0745 UAX Flight details.xlsm\'\n\nXLS_FILE_NAME = YEST + r\' 0745 Weekly UAX Flight details.xlsm\'\n\nEDW_SQL_1= SQL_FOLDER + r\'/UA_SQL_1.sql\'\nEDW_SQL_2= SQL_FOLDER +r\'/CNXL_SQL_2.sql\'\nEDW_SQL_3= SQL_FOLDER +r\'/RES_CNXL_SQL_3.sql\'\nEDW_SQL_4= SQL_FOLDER +r\'/SCH_DEP_SQL_4.sql\'\nEDW_SQL_5= SQL_FOLDER +r\'/DIVERTS_SQL_5.sql\'\nEDW_SQL_6= SQL_FOLDER +r\'/RECOVERED_DIVERTS_SQL_6.sql\'\nEDW_SQL_7= SQL_FOLDER +r\'/UA_HUB_SQL_7.sql\'\nEDW_SQL_8= SQL_FOLDER +r\'/FLIGHTS_NOT_DEPARTED_SQL_8.sql\'\n\nEDW_SQL_9= SQL_FOLDER +r\'/Cancelled_flights_SQL_9.sql\' ## Converted\nEDW_SQL_10= SQL_FOLDER +r\'/Yet_to_Depart_flights_SQL_10.sql\'\nEDW_SQL_11= SQL_FOLDER +r\'/Residual_cancels_SQL_11.sql\' ## Converted\nEDW_SQL_12= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_SQL_12.sql\'\n\nEDW_SQL_13= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_COUNT_SQL_13.sql\'\nEDW_SQL_14= SQL_FOLDER +r\'/Diverted_flights_SQL_14.sql\'\nEDW_SQL_15 = SQL_FOLDER + r\'/UA_Line.sql\'\nEDW_SQL_16 = SQL_FOLDER + r\'/UA_Seat_Cancels.sql\'\nEDW_SQL_17 = SQL_FOLDER + r\'/Carrier_delays.sql\'\nEDW_SQL_18= SQL_FOLDER +r\'/Delays_info.sql\'\n\n\n\nMF_SQL_1= SQL_FOLDER +r\'/OA_SQL_1.sql\'\nMF_SQL_2= SQL_FOLDER +r\'/OA_SQL_2.sql\'\nMF_SQL_3= SQL_FOLDER +r\'/OA_Line.sql\'\nMF_SQL_4= SQL_FOLDER +r\'/OA_SeatCnxl.sql\'\nUA_SQL_1_CSV_FILE = CSV_FLDR + r\'UA_SQL_1_\' +TODAY+\'.csv\'\nCNXL_SQL_2_CSV_FILE = CSV_FLDR + r\'CNXL_SQL_2_\' +TODAY+\'.csv\'\nRES_CNXL_SQL_3_CSV_FILE = CSV_FLDR + r\'RES_CNXL_SQL_3_\' +TODAY+\'.csv\'\nSCH_DEP_SQL_4_CSV_FILE = CSV_FLDR + r\'SCH_DEP_SQL_4_\' +TODAY+\'.csv\'\nDIVERTS_SQL_5_CSV_FILE = CSV_FLDR + r\'DIVERTS_SQL_5_\' +TODAY+\'.csv\'\nRECOVERED_DIVERTS_SQL_6_CSV_FILE = CSV_FLDR + r\'RECOVERED_DIVERTS_SQL_6_\' +TODAY+\'.csv\'\nUA_HUB_SQL_7_CSV_FILE = CSV_FLDR + r\'UA_HUB_SQL_7_\' +TODAY+\'.csv\'\nFLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE = CSV_FLDR + r\'FLIGHTS_NOT_DEPARTED_SQL_8_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_COUNT_SQL_13_\' +TODAY+\'.csv\'\nCancelled_flights_SQL_9_CSV_FILE = CSV_FLDR + r\'Cancelled_flights_SQL_9_\' +TODAY+\'.csv\'\nYet_to_Depart_flights_SQL_10_CSV_FILE = CSV_FLDR + r\'Yet_to_Depart_flights_SQL_10_\' +TODAY+\'.csv\'\nResidual_cancels_SQL_11_CSV_FILE = CSV_FLDR + r\'Residual_cancels_SQL_11_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_SQL_12_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_SQL_12_\' +TODAY+\'.csv\'\nDIVERTED_FLIGHTS_SQL_14_CSV_FILE = CSV_FLDR + r\'Diverted_flights_SQL_14\' +TODAY+\'.csv\'\nUA_Line_CSV_FILE = CSV_FLDR + r\'UA_Line\' +TODAY+\'.csv\'\nUA_Seat_Cancels_CSV_FILE = CSV_FLDR + r\'UA_Seat_Cancels\' +TODAY+\'.csv\'\nDELAYS_INFO_CSV_FILE = CSV_FLDR + r\'Delays_info\' +TODAY+\'.csv\'\nCarrier_delays_CSV_FILE = CSV_FLDR + r\'Carrier_delays\' +TODAY+\'.csv\'\nOA_SQL_1_CSV_FILE = CSV_FLDR + r\'OA_SQL_1_\' +TODAY+\'.csv\'\nOA_SQL_2_CSV_FILE = CSV_FLDR + r\'OA_SQL_2_\' +TODAY+\'.csv\'\nOA_Line_CSV_FILE = CSV_FLDR + r\'OA_Line_\' +TODAY+\'.csv\'\nOA_SeatCnxl_CSV_FILE = CSV_FLDR + r\'OA_SeatCnxl_\' +TODAY+\'.csv\'\nPNG_FILE_SYS1 = PNG_FLDR + TODAY + r\' pg1.png\'\nXLS_SHT_SYS1 = \'pg1\'\nPNG_FILE_SYS2 = PNG_FLDR + TODAY + r\' pg2.png\'\nXLS_SHT_SYS2 = \'pg2\'\nPDF_FILE_PATH = PDF_FLDR + YEST + r\'_745_UAX\' +\'.pdf\'\n\nlogging.basicConfig(filename=LOG_FILE_NAME, level=logging.DEBUG, format=\'%(asctime)s %(message)s\')\n\nlogging.info(\'Connecting to Teradata\');\n\n# Database credentials for UDH\nudh_username = \'app_noc_daily_ops_call\'\nudh_pass = \'SBhe09r7h20gsav\'\n\n# Connect to UDH (Redshift)\nlogging.info(\'Connecting to UDH\')\nprint(\'Connecting to UDH\')\n\ntry:\n    connection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host=\'cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com\',\n        dbname=\'udhprod\',\n        port=5439\n    )\n    logging.info(\'UDH connection successful\')\nexcept Exception as e:\n    logging.error(f\'UDH connection failed: {str(e)}\')\n    raise\n\ne1 = open(EDW_SQL_1, \'r\')\nsqlEdw1 = e1.read()\ne1.close()\n\ne2 = open(EDW_SQL_2, \'r\')\nsqlEdw2 = e2.read()\ne2.close()\n\ne3 = open(EDW_SQL_3, \'r\')\nsqlEdw3 = e3.read()\ne3.close()\n\ne4 = open(EDW_SQL_4, \'r\')\nsqlEdw4 = e4.read()\ne4.close()\n\ne5 = open(EDW_SQL_5, \'r\')\nsqlEdw5 = e5.read()\ne5.close()\n\ne6 = open(EDW_SQL_6, \'r\')\nsqlEdw6 = e6.read()\ne6.close()\n\ne7 = open(EDW_SQL_7, \'r\')\nsqlEdw7 = e7.read()\ne7.close()\n\ne8 = open(EDW_SQL_8, \'r\')\nsqlEdw8 = e8.read()\ne8.close()\n\ne9 = open(EDW_SQL_9, \'r\')\nsqlEdw9 = e9.read()\ne9.close()\n\ne10 = open(EDW_SQL_10, \'r\')\nsqlEdw10 = e10.read()\ne10.close()\n\ne11 = open(EDW_SQL_11, \'r\')\nsqlEdw11 = e11.read()\ne11.close()\n\ne12 = open(EDW_SQL_12, \'r\')\nsqlEdw12 = e12.read()\ne12.close()\n\ne13 = open(EDW_SQL_13, \'r\')\nsqlEdw13 = e13.read()\ne13.close()\n\ne14 = open(EDW_SQL_14, \'r\')\nsqlEdw14 = e14.read()\ne14.close()\n\ne15 = open(EDW_SQL_15, \'r\')\nsqlEdw15 = e15.read()\ne15.close()\n\ne16 = open(EDW_SQL_16, \'r\')\nsqlEdw16 = e16.read()\ne16.close()\n\ne17 = open(EDW_SQL_17, \'r\')\nsqlEdw17 = e17.read()\ne17.close()\n\ne18 = open(EDW_SQL_18, \'r\')\nsqlEdw18 = e18.read()\ne18.close()\n\nsqlresult_1 = pd.read_sql_query(sqlEdw1, connection)\nsqlresult_1.to_csv(UA_SQL_1_CSV_FILE, index=False)\n\nsqlresult_2 = pd.read_sql_query(sqlEdw2, connection)\nsqlresult_2.to_csv(CNXL_SQL_2_CSV_FILE, index=False)\n\nsqlresult_3 = pd.read_sql_query(sqlEdw3, connection)\nsqlresult_3.to_csv(RES_CNXL_SQL_3_CSV_FILE, index=False)\n\nsqlresult_4 = pd.read_sql_query(sqlEdw4, connection)\nsqlresult_4.to_csv(SCH_DEP_SQL_4_CSV_FILE, index=False)\n\nsqlresult_5 = pd.read_sql_query(sqlEdw5, connection)\nsqlresult_5.to_csv(DIVERTS_SQL_5_CSV_FILE, index=False)\n\nsqlresult_6 = pd.read_sql_query(sqlEdw6, connection)\nsqlresult_6.to_csv(RECOVERED_DIVERTS_SQL_6_CSV_FILE, index=False)\n\nsqlresult_7 = pd.read_sql_query(sqlEdw7, connection)\nsqlresult_7.to_csv(UA_HUB_SQL_7_CSV_FILE, index=False)\n\nsqlresult_10 = pd.read_sql_query(sqlEdw8, connection)\nsqlresult_10.to_csv(FLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE, index=False)\n\nsqlresult_11 = pd.read_sql_query(sqlEdw9, connection)\nsqlresult_11.to_csv(Cancelled_flights_SQL_9_CSV_FILE, index=False)\n\nsqlresult_12 = pd.read_sql_query(sqlEdw10, connection)\nsqlresult_12.to_csv(Yet_to_Depart_flights_SQL_10_CSV_FILE, index=False)\n\nsqlresult_13 = pd.read_sql_query(sqlEdw11, connection)\nsqlresult_13.to_csv(Residual_cancels_SQL_11_CSV_FILE, index=False)\n\nsqlresult_14 = pd.read_sql_query(sqlEdw12, connection)\nsqlresult_14.to_csv(REPOSITIONED_FLIGHTS_SQL_12_CSV_FILE, index=False)\n\nsqlresult_15 = pd.read_sql_query(sqlEdw13, connection)\nsqlresult_15.to_csv(REPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE, index=False)\n\nsqlresult_16 = pd.read_sql_query(sqlEdw14, connection)\nsqlresult_16.to_csv(DIVERTED_FLIGHTS_SQL_14_CSV_FILE, index=False)\n\nsqlresult_17 = pd.read_sql_query(sqlEdw15, connection)\nsqlresult_17.to_csv(UA_Line_CSV_FILE, index=False)\n\nsqlresult_18 = pd.read_sql_query(sqlEdw16, connection)\nsqlresult_18.to_csv(UA_Seat_Cancels_CSV_FILE, index=False)\n\nsqlresult_19 = pd.read_sql_query(sqlEdw17, connection)\nsqlresult_19.to_csv(Carrier_delays_CSV_FILE, index=False)\n\nsqlresult_20 = pd.read_sql_query(sqlEdw18, connection)\nsqlresult_20.to_csv(DELAYS_INFO_CSV_FILE, index=False)\nlogging.info(\'Running MF SQL queries\');\n\nmasflight_connection_string = "mysql+pymysql://ua_sumit_sharma1:uukexRCsHyAb9kw6rcMX@54.163.228.37:3306/masflightdb_customers_prd?charset=utf8mb4"\nlogging.info(\'Connecting to Masflight\')\n\nm1 = open(MF_SQL_1, \'r\')\nsqlMf1 = text(m1.read())\nm1.close()\n\nm2 = open(MF_SQL_2, \'r\')\nsqlMf2 = text(m2.read())\nm2.close()\n\nm3 = open(MF_SQL_3, \'r\')\nsqlMf3 = text(m3.read())\nm3.close()\n\nm4 = open(MF_SQL_4, \'r\')\nsqlMf4 = text(m4.read())\nm4.close()\n\n\n'}, 'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}, {'startLine': 269, 'stopLine': 288, 'commandId': 8801006436713105}, {'startLine': 288, 'stopLine': 289}], 'id': 15}}}}}, 'buffers': []})
2025-11-14 07:32:51,476 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'da5b7916-0d52-4ae7-b6fa-00afa062bd80', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 32, 51, 423000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'da5b7916-0d52-4ae7-b6fa-00afa062bd80', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}, {'startLine': 269, 'stopLine': 288, 'commandId': 8801006436713105}, {'startLine': 288, 'stopLine': 289, 'commandId': 8801006436713106}], 'editedCommandId': 8801006436713106, 'contentChanges': [{'range': {'start': {'line': 288, 'character': 0}, 'end': {'line': 289, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 288, 'character': 0}, 'end': {'line': 288, 'character': 0}}, 'text': '\n'}], 'cursorPosition': {'line': 288, 'character': 0}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 2}, 'id': 16}}}}}, 'buffers': []})
2025-11-14 07:32:51,757 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '24db72a7-12a0-4d93-80eb-014ef75b800f', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 32, 51, 702000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '24db72a7-12a0-4d93-80eb-014ef75b800f', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didOpen', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'text': 'from databricks.sdk.runtime import display, displayHTML, getArgument, sc, spark, sql, sqlContext, table, udf;from dbruntime.dbutils import DBUtils as dbutils;from IPython import get_ipython;In={};Out={};_ih=[];_oh={};_dh=[];_=None;__=None;___=None;_i=None;_ii=None;_sqldf=spark.createDataFrame([], schema=[])\n# %pip install "sqlalchemy<2.0"\ndbutils.library.restartPython()\n\nmode = \'PROD\'\n\n\n\nimport pandas as pd\nimport datetime\nimport logging\nimport os\nimport pyodbc\nimport smtplib as smtp\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.text import MIMEText\n\nfrom email.utils import formataddr\nfrom email.header import Header\nfrom email import encoders\nfrom email.mime.base import MIMEBase\nfrom email.mime.application import MIMEApplication\nfrom email.mime.image import MIMEImage\nimport urllib.parse\nfrom sqlalchemy import create_engine, text\nimport re\nfrom random import *\nimport psycopg2\nos.chdir(r\'/Workspace/Ops Analysis/Reports/745 express weekly\')\nTODAY = datetime.datetime.today().strftime(\'%Y%m%d\')\nYES = datetime.date.today() - datetime.timedelta(days=1)\nLW = datetime.date.today() - datetime.timedelta(days=7)\nYESTERDAY = YES.strftime(\'%m/%d/%Y\')\nLWDATE = LW.strftime(\'%m/%d/%Y\')\nYEST = YES.strftime(\'%Y-%m-%d\')\n\nif mode == \'PROD\':\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr.csv\'\nelse:\n    EMAIL_ADDR_FILE = os.getcwd() + r\'/emailAddr_test.csv\'\n    \nLOG_FILE_NAME = os.getcwd() + r\'/logs/\' + datetime.datetime.today().strftime(\'%Y%m%d %H%M%S\') + \'.log\'\nCSV_FLDR = os.getcwd() + r\'/CSV/\'\nSQL_FOLDER = os.getcwd() + r\'/SQL\'\nXLSX_FLDR = os.getcwd() + r\'/XLSX/\'\nHTML_FLDR = os.getcwd() + r\'/HTML/\'\nPNG_FLDR = os.getcwd() + r\'/DailyImages/\'\nfilename_attach = os.getcwd() + r\'/0745_UAX_WB_Flights.xlsm\'\nPDF_FLDR = os.getcwd() + r\'/PDF/\'\nfilename = os.getcwd() + r\'/0745_UAX_WB_final_v1.xlsm\'\n\nCID1 =  \'1\'\nCID2 =  \'2\'\n\n\nHTML_BDY_FILE_PATH = HTML_FLDR + r\'EmailBody.htm\'\nHTML_FTR_FILE_PATH = HTML_FLDR + r\'EmailFooter.htm\'\n\nXLS_FILE_PATH = XLSX_FLDR + YEST + r\' 0745 UAX Flight details.xlsm\'\n\nXLS_FILE_NAME = YEST + r\' 0745 Weekly UAX Flight details.xlsm\'\n\nEDW_SQL_1= SQL_FOLDER + r\'/UA_SQL_1.sql\'\nEDW_SQL_2= SQL_FOLDER +r\'/CNXL_SQL_2.sql\'\nEDW_SQL_3= SQL_FOLDER +r\'/RES_CNXL_SQL_3.sql\'\nEDW_SQL_4= SQL_FOLDER +r\'/SCH_DEP_SQL_4.sql\'\nEDW_SQL_5= SQL_FOLDER +r\'/DIVERTS_SQL_5.sql\'\nEDW_SQL_6= SQL_FOLDER +r\'/RECOVERED_DIVERTS_SQL_6.sql\'\nEDW_SQL_7= SQL_FOLDER +r\'/UA_HUB_SQL_7.sql\'\nEDW_SQL_8= SQL_FOLDER +r\'/FLIGHTS_NOT_DEPARTED_SQL_8.sql\'\n\nEDW_SQL_9= SQL_FOLDER +r\'/Cancelled_flights_SQL_9.sql\' ## Converted\nEDW_SQL_10= SQL_FOLDER +r\'/Yet_to_Depart_flights_SQL_10.sql\'\nEDW_SQL_11= SQL_FOLDER +r\'/Residual_cancels_SQL_11.sql\' ## Converted\nEDW_SQL_12= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_SQL_12.sql\'\n\nEDW_SQL_13= SQL_FOLDER +r\'/REPOSITIONED_FLIGHTS_COUNT_SQL_13.sql\'\nEDW_SQL_14= SQL_FOLDER +r\'/Diverted_flights_SQL_14.sql\'\nEDW_SQL_15 = SQL_FOLDER + r\'/UA_Line.sql\'\nEDW_SQL_16 = SQL_FOLDER + r\'/UA_Seat_Cancels.sql\'\nEDW_SQL_17 = SQL_FOLDER + r\'/Carrier_delays.sql\'\nEDW_SQL_18= SQL_FOLDER +r\'/Delays_info.sql\'\n\n\n\nMF_SQL_1= SQL_FOLDER +r\'/OA_SQL_1.sql\'\nMF_SQL_2= SQL_FOLDER +r\'/OA_SQL_2.sql\'\nMF_SQL_3= SQL_FOLDER +r\'/OA_Line.sql\'\nMF_SQL_4= SQL_FOLDER +r\'/OA_SeatCnxl.sql\'\nUA_SQL_1_CSV_FILE = CSV_FLDR + r\'UA_SQL_1_\' +TODAY+\'.csv\'\nCNXL_SQL_2_CSV_FILE = CSV_FLDR + r\'CNXL_SQL_2_\' +TODAY+\'.csv\'\nRES_CNXL_SQL_3_CSV_FILE = CSV_FLDR + r\'RES_CNXL_SQL_3_\' +TODAY+\'.csv\'\nSCH_DEP_SQL_4_CSV_FILE = CSV_FLDR + r\'SCH_DEP_SQL_4_\' +TODAY+\'.csv\'\nDIVERTS_SQL_5_CSV_FILE = CSV_FLDR + r\'DIVERTS_SQL_5_\' +TODAY+\'.csv\'\nRECOVERED_DIVERTS_SQL_6_CSV_FILE = CSV_FLDR + r\'RECOVERED_DIVERTS_SQL_6_\' +TODAY+\'.csv\'\nUA_HUB_SQL_7_CSV_FILE = CSV_FLDR + r\'UA_HUB_SQL_7_\' +TODAY+\'.csv\'\nFLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE = CSV_FLDR + r\'FLIGHTS_NOT_DEPARTED_SQL_8_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_COUNT_SQL_13_\' +TODAY+\'.csv\'\nCancelled_flights_SQL_9_CSV_FILE = CSV_FLDR + r\'Cancelled_flights_SQL_9_\' +TODAY+\'.csv\'\nYet_to_Depart_flights_SQL_10_CSV_FILE = CSV_FLDR + r\'Yet_to_Depart_flights_SQL_10_\' +TODAY+\'.csv\'\nResidual_cancels_SQL_11_CSV_FILE = CSV_FLDR + r\'Residual_cancels_SQL_11_\' +TODAY+\'.csv\'\nREPOSITIONED_FLIGHTS_SQL_12_CSV_FILE = CSV_FLDR + r\'REPOSITIONED_FLIGHTS_SQL_12_\' +TODAY+\'.csv\'\nDIVERTED_FLIGHTS_SQL_14_CSV_FILE = CSV_FLDR + r\'Diverted_flights_SQL_14\' +TODAY+\'.csv\'\nUA_Line_CSV_FILE = CSV_FLDR + r\'UA_Line\' +TODAY+\'.csv\'\nUA_Seat_Cancels_CSV_FILE = CSV_FLDR + r\'UA_Seat_Cancels\' +TODAY+\'.csv\'\nDELAYS_INFO_CSV_FILE = CSV_FLDR + r\'Delays_info\' +TODAY+\'.csv\'\nCarrier_delays_CSV_FILE = CSV_FLDR + r\'Carrier_delays\' +TODAY+\'.csv\'\nOA_SQL_1_CSV_FILE = CSV_FLDR + r\'OA_SQL_1_\' +TODAY+\'.csv\'\nOA_SQL_2_CSV_FILE = CSV_FLDR + r\'OA_SQL_2_\' +TODAY+\'.csv\'\nOA_Line_CSV_FILE = CSV_FLDR + r\'OA_Line_\' +TODAY+\'.csv\'\nOA_SeatCnxl_CSV_FILE = CSV_FLDR + r\'OA_SeatCnxl_\' +TODAY+\'.csv\'\nPNG_FILE_SYS1 = PNG_FLDR + TODAY + r\' pg1.png\'\nXLS_SHT_SYS1 = \'pg1\'\nPNG_FILE_SYS2 = PNG_FLDR + TODAY + r\' pg2.png\'\nXLS_SHT_SYS2 = \'pg2\'\nPDF_FILE_PATH = PDF_FLDR + YEST + r\'_745_UAX\' +\'.pdf\'\n\nlogging.basicConfig(filename=LOG_FILE_NAME, level=logging.DEBUG, format=\'%(asctime)s %(message)s\')\n\nlogging.info(\'Connecting to Teradata\');\n\n# Database credentials for UDH\nudh_username = \'app_noc_daily_ops_call\'\nudh_pass = \'SBhe09r7h20gsav\'\n\n# Connect to UDH (Redshift)\nlogging.info(\'Connecting to UDH\')\nprint(\'Connecting to UDH\')\n\ntry:\n    connection = psycopg2.connect(\n        user=udh_username,\n        password=udh_pass,\n        host=\'cbs-udh-datalake-prod-redshift-dw1.csjkuisl0oi7.us-east-1.redshift.amazonaws.com\',\n        dbname=\'udhprod\',\n        port=5439\n    )\n    logging.info(\'UDH connection successful\')\nexcept Exception as e:\n    logging.error(f\'UDH connection failed: {str(e)}\')\n    raise\n\ne1 = open(EDW_SQL_1, \'r\')\nsqlEdw1 = e1.read()\ne1.close()\n\ne2 = open(EDW_SQL_2, \'r\')\nsqlEdw2 = e2.read()\ne2.close()\n\ne3 = open(EDW_SQL_3, \'r\')\nsqlEdw3 = e3.read()\ne3.close()\n\ne4 = open(EDW_SQL_4, \'r\')\nsqlEdw4 = e4.read()\ne4.close()\n\ne5 = open(EDW_SQL_5, \'r\')\nsqlEdw5 = e5.read()\ne5.close()\n\ne6 = open(EDW_SQL_6, \'r\')\nsqlEdw6 = e6.read()\ne6.close()\n\ne7 = open(EDW_SQL_7, \'r\')\nsqlEdw7 = e7.read()\ne7.close()\n\ne8 = open(EDW_SQL_8, \'r\')\nsqlEdw8 = e8.read()\ne8.close()\n\ne9 = open(EDW_SQL_9, \'r\')\nsqlEdw9 = e9.read()\ne9.close()\n\ne10 = open(EDW_SQL_10, \'r\')\nsqlEdw10 = e10.read()\ne10.close()\n\ne11 = open(EDW_SQL_11, \'r\')\nsqlEdw11 = e11.read()\ne11.close()\n\ne12 = open(EDW_SQL_12, \'r\')\nsqlEdw12 = e12.read()\ne12.close()\n\ne13 = open(EDW_SQL_13, \'r\')\nsqlEdw13 = e13.read()\ne13.close()\n\ne14 = open(EDW_SQL_14, \'r\')\nsqlEdw14 = e14.read()\ne14.close()\n\ne15 = open(EDW_SQL_15, \'r\')\nsqlEdw15 = e15.read()\ne15.close()\n\ne16 = open(EDW_SQL_16, \'r\')\nsqlEdw16 = e16.read()\ne16.close()\n\ne17 = open(EDW_SQL_17, \'r\')\nsqlEdw17 = e17.read()\ne17.close()\n\ne18 = open(EDW_SQL_18, \'r\')\nsqlEdw18 = e18.read()\ne18.close()\n\nsqlresult_1 = pd.read_sql_query(sqlEdw1, connection)\nsqlresult_1.to_csv(UA_SQL_1_CSV_FILE, index=False)\n\nsqlresult_2 = pd.read_sql_query(sqlEdw2, connection)\nsqlresult_2.to_csv(CNXL_SQL_2_CSV_FILE, index=False)\n\nsqlresult_3 = pd.read_sql_query(sqlEdw3, connection)\nsqlresult_3.to_csv(RES_CNXL_SQL_3_CSV_FILE, index=False)\n\nsqlresult_4 = pd.read_sql_query(sqlEdw4, connection)\nsqlresult_4.to_csv(SCH_DEP_SQL_4_CSV_FILE, index=False)\n\nsqlresult_5 = pd.read_sql_query(sqlEdw5, connection)\nsqlresult_5.to_csv(DIVERTS_SQL_5_CSV_FILE, index=False)\n\nsqlresult_6 = pd.read_sql_query(sqlEdw6, connection)\nsqlresult_6.to_csv(RECOVERED_DIVERTS_SQL_6_CSV_FILE, index=False)\n\nsqlresult_7 = pd.read_sql_query(sqlEdw7, connection)\nsqlresult_7.to_csv(UA_HUB_SQL_7_CSV_FILE, index=False)\n\nsqlresult_10 = pd.read_sql_query(sqlEdw8, connection)\nsqlresult_10.to_csv(FLIGHTS_NOT_DEPARTED_SQL_8_CSV_FILE, index=False)\n\nsqlresult_11 = pd.read_sql_query(sqlEdw9, connection)\nsqlresult_11.to_csv(Cancelled_flights_SQL_9_CSV_FILE, index=False)\n\nsqlresult_12 = pd.read_sql_query(sqlEdw10, connection)\nsqlresult_12.to_csv(Yet_to_Depart_flights_SQL_10_CSV_FILE, index=False)\n\nsqlresult_13 = pd.read_sql_query(sqlEdw11, connection)\nsqlresult_13.to_csv(Residual_cancels_SQL_11_CSV_FILE, index=False)\n\nsqlresult_14 = pd.read_sql_query(sqlEdw12, connection)\nsqlresult_14.to_csv(REPOSITIONED_FLIGHTS_SQL_12_CSV_FILE, index=False)\n\nsqlresult_15 = pd.read_sql_query(sqlEdw13, connection)\nsqlresult_15.to_csv(REPOSITIONED_FLIGHTS_COUNT_SQL_13_CSV_FILE, index=False)\n\nsqlresult_16 = pd.read_sql_query(sqlEdw14, connection)\nsqlresult_16.to_csv(DIVERTED_FLIGHTS_SQL_14_CSV_FILE, index=False)\n\nsqlresult_17 = pd.read_sql_query(sqlEdw15, connection)\nsqlresult_17.to_csv(UA_Line_CSV_FILE, index=False)\n\nsqlresult_18 = pd.read_sql_query(sqlEdw16, connection)\nsqlresult_18.to_csv(UA_Seat_Cancels_CSV_FILE, index=False)\n\nsqlresult_19 = pd.read_sql_query(sqlEdw17, connection)\nsqlresult_19.to_csv(Carrier_delays_CSV_FILE, index=False)\n\nsqlresult_20 = pd.read_sql_query(sqlEdw18, connection)\nsqlresult_20.to_csv(DELAYS_INFO_CSV_FILE, index=False)\nlogging.info(\'Running MF SQL queries\');\n\nmasflight_connection_string = "mysql+pymysql://ua_sumit_sharma1:uukexRCsHyAb9kw6rcMX@54.163.228.37:3306/masflightdb_customers_prd?charset=utf8mb4"\nlogging.info(\'Connecting to Masflight\')\n\nm1 = open(MF_SQL_1, \'r\')\nsqlMf1 = text(m1.read())\nm1.close()\n\nm2 = open(MF_SQL_2, \'r\')\nsqlMf2 = text(m2.read())\nm2.close()\n\nm3 = open(MF_SQL_3, \'r\')\nsqlMf3 = text(m3.read())\nm3.close()\n\nm4 = open(MF_SQL_4, \'r\')\nsqlMf4 = text(m4.read())\nm4.close()\n\n\n'}, 'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}, {'startLine': 269, 'stopLine': 288, 'commandId': 8801006436713105}, {'startLine': 288, 'stopLine': 289, 'commandId': 8801006436713106}], 'id': 17}}}}}, 'buffers': []})
2025-11-14 07:32:59,426 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '539bffc2-f938-4269-9af6-e4d8df9f8a25', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 32, 59, 332000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '539bffc2-f938-4269-9af6-e4d8df9f8a25', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}, {'startLine': 269, 'stopLine': 288, 'commandId': 8801006436713105}, {'startLine': 288, 'stopLine': 304, 'commandId': 8801006436713106}], 'editedCommandId': 8801006436713106, 'contentChanges': [{'range': {'start': {'line': 288, 'character': 0}, 'end': {'line': 289, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 288, 'character': 0}, 'end': {'line': 288, 'character': 0}}, 'text': "sqlresult_8 = pd.read_sql_query(sqlMf1,masflight_connection_string)\nsqlresult_8.to_csv(OA_SQL_1_CSV_FILE, index=False)\n\nsqlresult_9 = pd.read_sql_query(sqlMf2,masflight_connection_string)\nsqlresult_9.to_csv(OA_SQL_2_CSV_FILE, index=False)\n\nsqlresult_21 = pd.read_sql_query(sqlMf3,masflight_connection_string)\nsqlresult_21.to_csv(OA_Line_CSV_FILE, index=False)\n\nsqlresult_22 = pd.read_sql_query(sqlMf4,masflight_connection_string)\nsqlresult_22.to_csv(OA_SeatCnxl_CSV_FILE, index=False)\n\nlogging.info('SQL queries run');\nprint('SQL run')\n\nlogging.info('Opening excel file');\n"}], 'cursorPosition': {'line': 303, 'character': 35}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 3}, 'id': 18}}}}}, 'buffers': []})
2025-11-14 07:32:59,553 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '02b1706a-4a76-4265-bb42-a2eeaf314737', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 32, 59, 511000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '02b1706a-4a76-4265-bb42-a2eeaf314737', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'method': 'textDocument/definition', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477'}, 'position': {'line': 288, 'character': 1}}, 'id': 3, 'jsonrpc': '2.0', 'cachedFilesAndMtimes': {}}}}}, 'buffers': []})
2025-11-14 07:33:00,898 Received command c on object id p0
2025-11-14 07:33:01,185 Command to send: c
o397
get
sspark.databricks.driver.ipykernel.maxErrorMessageLength
s100000
e

2025-11-14 07:33:01,185 Answer received: !ys100000
2025-11-14 07:33:01,186 Command to send: c
o397
get
sspark.databricks.driver.ipykernel.maxErrorMessageLength
s100000
e

2025-11-14 07:33:01,207 Answer received: !ys100000
2025-11-14 07:33:17,327 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '3ddb880b-da16-4b87-986a-3af991a52f53', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 33, 17, 286000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '3ddb880b-da16-4b87-986a-3af991a52f53', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'method': 'textDocument/definition', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477'}, 'position': {'line': 295, 'character': 41}}, 'id': 4, 'jsonrpc': '2.0', 'cachedFilesAndMtimes': {}}}}}, 'buffers': []})
2025-11-14 07:33:17,347 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'dac68f68-3304-4ba0-ba9d-8fabefd75cd4', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 33, 17, 301000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'dac68f68-3304-4ba0-ba9d-8fabefd75cd4', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': '$/cancelRequest', 'params': {'id': 4}}}}}, 'buffers': []})
2025-11-14 07:33:18,917 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': '935ec416-6ee1-49d0-8699-8afb541c8255', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 33, 18, 859000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': '935ec416-6ee1-49d0-8699-8afb541c8255', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'method': 'textDocument/definition', 'params': {'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477'}, 'position': {'line': 288, 'character': 42}}, 'id': 5, 'jsonrpc': '2.0', 'cachedFilesAndMtimes': {}}}}}, 'buffers': []})
2025-11-14 07:33:58,518 handle_msg[LSP_COMM_ID]({'header': {'msg_type': 'comm_msg', 'msg_id': 'f9041f61-9cb6-4c0b-b05a-529ac8f95fca', 'session': '', 'username': '', 'date': datetime.datetime(2025, 11, 14, 7, 33, 58, 438000, tzinfo=tzlocal()), 'version': '5.4'}, 'msg_id': 'f9041f61-9cb6-4c0b-b05a-529ac8f95fca', 'msg_type': 'comm_msg', 'parent_header': {'session': '', 'username': '', 'version': '5.3'}, 'metadata': {'enableLSPGoToDefinitionOnModule_v2': 'true', 'enableWSFSPythonModulePeek': 'false', 'jediAutoImportModulesList': 'asyncio,numpy,pandas,pyspark,pyspark.ml,pyspark.sql,seaborn,urllib3'}, 'content': {'comm_id': 'LSP_COMM_ID', 'data': {'header': {'lsm_protocol_version': 0, 'msg_type': 'lsp_msg', 'ls_instance_id': '11b12678-77cf-4442-abf0-8f77760eb898'}, 'body': {'lsp_msg': {'jsonrpc': '2.0', 'method': 'textDocument/didChange', 'params': {'cellRanges': [{'startLine': 0, 'stopLine': 4, 'commandId': 8801006436713080}, {'startLine': 4, 'stopLine': 28, 'commandId': 6252130007789254}, {'startLine': 28, 'stopLine': 35, 'commandId': 6252130007790467}, {'startLine': 35, 'stopLine': 54, 'commandId': 8801006436713084}, {'startLine': 54, 'stopLine': 62, 'commandId': 8801006436713085}, {'startLine': 62, 'stopLine': 89, 'commandId': 8801006436713087}, {'startLine': 89, 'stopLine': 111, 'commandId': 8801006436713088}, {'startLine': 111, 'stopLine': 121, 'commandId': 8801006436713090}, {'startLine': 121, 'stopLine': 141, 'commandId': 8801006436713092}, {'startLine': 141, 'stopLine': 214, 'commandId': 8801006436713094}, {'startLine': 214, 'stopLine': 269, 'commandId': 8801006436713097}, {'startLine': 269, 'stopLine': 288, 'commandId': 8801006436713105}, {'startLine': 288, 'stopLine': 304, 'commandId': 8801006436713106}], 'editedCommandId': 8801006436713080, 'contentChanges': [{'range': {'start': {'line': 1, 'character': 0}, 'end': {'line': 4, 'character': 0}}, 'text': ''}, {'range': {'start': {'line': 1, 'character': 0}, 'end': {'line': 1, 'character': 0}}, 'text': '# %pip install "sqlalchemy<2.0"\ndbutils.library.restartPython()\n# %pip install sqlalchemy\n'}], 'cursorPosition': {'line': 3, 'character': 23}, 'textDocument': {'uri': '/notebook/dddd44d6-8d57-49d8-8393-6f61dff7f820/2297197064326477', 'version': 4}, 'id': 19}}}}}, 'buffers': []})
2025-11-14 07:34:01,661 Received command c on object id p0
2025-11-14 07:34:01,675 Command to send: c
t
getNotebookScopedPythonEnvManager
e

2025-11-14 07:34:01,676 Answer received: !yro451
2025-11-14 07:34:01,676 Command to send: c
o451
parseCmd
spip
sinstall "sqlalchemy<2.0"
e

2025-11-14 07:34:01,676 Answer received: !yro452
2025-11-14 07:34:01,676 Command to send: c
o452
error
e

2025-11-14 07:34:01,677 Answer received: !ys
2025-11-14 07:34:01,677 Command to send: c
o452
warning
e

2025-11-14 07:34:01,677 Answer received: !ys
2025-11-14 07:34:01,677 Command to send: c
o452
isMutation
e

2025-11-14 07:34:01,677 Answer received: !ybtrue
2025-11-14 07:34:01,678 Command to send: c
o451
getIsEnvCloned
e

2025-11-14 07:34:01,678 Answer received: !ybtrue
2025-11-14 07:34:01,678 Command to send: c
o451
markAsCustomized
e

2025-11-14 07:34:01,679 Answer received: !yv
2025-11-14 07:34:01,679 Command to send: c
o452
rewrittenCommand
e

2025-11-14 07:34:01,679 Answer received: !ys--disable-pip-version-check install "sqlalchemy<2.0"
2025-11-14 07:34:01,680 Command to send: c
t
getNotebookScopedPythonEnvManager
e

2025-11-14 07:34:01,680 Answer received: !yro453
2025-11-14 07:34:01,680 Command to send: c
o452
magicCmd
e

2025-11-14 07:34:01,680 Answer received: !yspip
2025-11-14 07:34:01,680 Command to send: c
o452
rewrittenCommand
e

2025-11-14 07:34:01,680 Answer received: !ys--disable-pip-version-check install "sqlalchemy<2.0"
2025-11-14 07:34:01,681 Command to send: c
o452
virtualEnvScript
e

2025-11-14 07:34:01,681 Answer received: !ys/local_disk0/.ephemeral_nfs/envs/pythonEnv-531d5ee8-d76f-401f-bee7-8820e3bf6650/python_start_notebook_scoped.sh
2025-11-14 07:34:05,393 Command to send: c
o453
logPipCommandDuration
ro452
d3.7112858295440674
i0
e

2025-11-14 07:34:05,427 Answer received: !yv
2025-11-14 07:34:05,428 Command to send: c
o451
postExecute
ro452
e

2025-11-14 07:34:07,097 Answer received: !yv
2025-11-14 07:34:07,103 Command to send: c
o452
isMutation
e

2025-11-14 07:34:07,104 Answer received: !ybtrue
2025-11-14 07:34:08,113 Command to send: c
t
restartInterpAfterExecution
e

2025-11-14 07:34:08,113 Answer received: !yv
2025-11-14 07:34:08,114 Command to send: c
t
getNotebookScopedPythonEnvManager
e

2025-11-14 07:34:08,114 Answer received: !yro454
2025-11-14 07:34:08,114 Command to send: c
o454
parseCmd
spip
sinstall sqlalchemy
e

2025-11-14 07:34:08,115 Answer received: !yro455
2025-11-14 07:34:08,115 Command to send: c
o455
error
e

2025-11-14 07:34:08,115 Answer received: !ys
2025-11-14 07:34:08,116 Command to send: c
o455
warning
e

2025-11-14 07:34:08,116 Answer received: !ys
2025-11-14 07:34:08,116 Command to send: c
o455
isMutation
e

2025-11-14 07:34:08,116 Answer received: !ybtrue
2025-11-14 07:34:08,116 Command to send: c
o454
getIsEnvCloned
e

2025-11-14 07:34:08,116 Answer received: !ybtrue
2025-11-14 07:34:08,116 Command to send: c
o454
markAsCustomized
e

2025-11-14 07:34:08,117 Answer received: !yv
2025-11-14 07:34:08,118 Command to send: c
o455
rewrittenCommand
e

2025-11-14 07:34:08,118 Answer received: !ys--disable-pip-version-check install sqlalchemy
2025-11-14 07:34:08,118 Command to send: c
t
getNotebookScopedPythonEnvManager
e

2025-11-14 07:34:08,119 Answer received: !yro456
2025-11-14 07:34:08,119 Command to send: c
o455
magicCmd
e

2025-11-14 07:34:08,119 Answer received: !yspip
2025-11-14 07:34:08,119 Command to send: c
o455
rewrittenCommand
e

2025-11-14 07:34:08,119 Answer received: !ys--disable-pip-version-check install sqlalchemy
2025-11-14 07:34:08,119 Command to send: c
o455
virtualEnvScript
e

2025-11-14 07:34:08,120 Answer received: !ys/local_disk0/.ephemeral_nfs/envs/pythonEnv-531d5ee8-d76f-401f-bee7-8820e3bf6650/python_start_notebook_scoped.sh
